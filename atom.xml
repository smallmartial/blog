<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>smallmartial&#39;s blog</title>
  
  
  <link href="/blog/atom.xml" rel="self"/>
  
  <link href="https://github.com/smallmartial/blog.git/"/>
  <updated>2019-04-17T08:59:47.234Z</updated>
  <id>https://github.com/smallmartial/blog.git/</id>
  
  <author>
    <name>小武</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>乐优商城学习笔记八-商品管理(修改商品)</title>
    <link href="https://github.com/smallmartial/blog.git/2019/04/17/lyshop-8/"/>
    <id>https://github.com/smallmartial/blog.git/2019/04/17/lyshop-8/</id>
    <published>2019-04-17T08:43:46.000Z</published>
    <updated>2019-04-17T08:59:47.234Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-商品修改"><a href="#1-商品修改" class="headerlink" title="1.商品修改"></a>1.商品修改</h1><h2 id="1-1-编辑按钮点击事件"><a href="#1-1-编辑按钮点击事件" class="headerlink" title="1.1.编辑按钮点击事件"></a>1.1.编辑按钮点击事件</h2><p>在商品详情页，每一个商品后面，都会有一个编辑按钮：</p><p> <img src="http://img.smallmartial.cn/1528874711108.png" alt="1528874711108"></p><p>点击这个按钮，就会打开一个商品编辑窗口，我们看下它所绑定的点击事件：</p><p> <img src="http://img.smallmartial.cn//1528874805077.png" alt="1528874805077"></p><p>对应的方法：<br> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">async</span> editGoods(oldGoods) &#123;</span><br><span class="line">  <span class="comment">// 发起请求，查询商品详情和skus</span></span><br><span class="line">  oldGoods.spuDetail = <span class="keyword">await</span> <span class="keyword">this</span>.$http.loadData(<span class="string">"/item/spu/detail/"</span> + oldGoods.id);</span><br><span class="line">  oldGoods.skus = <span class="keyword">await</span> <span class="keyword">this</span>.$http.loadData(<span class="string">"/item/sku/list?id="</span> + oldGoods.id);</span><br><span class="line">  <span class="comment">// 修改标记</span></span><br><span class="line">  <span class="keyword">this</span>.isEdit = <span class="literal">true</span>;</span><br><span class="line">  <span class="comment">// 控制弹窗可见：</span></span><br><span class="line">  <span class="keyword">this</span>.show = <span class="literal">true</span>;</span><br><span class="line">  <span class="comment">// 获取要编辑的goods</span></span><br><span class="line">  <span class="keyword">this</span>.oldGoods = oldGoods;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p><p>可以看到这里发起了两个请求，在查询商品详情和sku信息。</p><p>因为在商品列表页面，只有spu的基本信息：id、标题、品牌、商品分类等。比较复杂的商品详情（spuDetail)和sku信息都没有，编辑页面要回显数据，就需要查询这些内容。</p><p>因此，接下来我们就编写后台接口，提供查询服务接口。</p><h2 id="2-2-查询SpuDetail接口"><a href="#2-2-查询SpuDetail接口" class="headerlink" title="2.2.查询SpuDetail接口"></a>2.2.查询SpuDetail接口</h2><blockquote><p>controller</p></blockquote><p>需要分析的内容：</p><ul><li>请求方式：GET</li><li>请求路径：/spu/detail/{id}</li><li>请求参数：id，应该是spu的id</li><li>返回结果：SpuDetail对象</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/spu/detail/&#123;id&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;SpuDetail&gt; <span class="title">querySpuDetailById</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Long id) </span>&#123;</span><br><span class="line">    SpuDetail detail = <span class="keyword">this</span>.goodsService.querySpuDetailById(id);</span><br><span class="line">    <span class="keyword">if</span> (detail == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(HttpStatus.NOT_FOUND);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(detail);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>service</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> SpuDetail <span class="title">querySpuDetailById</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.spuDetailMapper.selectByPrimaryKey(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>测试<br><img src="http://img.smallmartial.cn/QQ%E6%88%AA%E5%9B%BE20190417164945.png" alt></p></blockquote><h2 id="2-3-查询sku"><a href="#2-3-查询sku" class="headerlink" title="2.3.查询sku"></a>2.3.查询sku</h2><blockquote><p>分析</p></blockquote><ul><li>请求方式：Get</li><li>请求路径：/sku/list</li><li>请求参数：id，应该是spu的id</li><li>返回结果：sku的集合</li></ul><blockquote><p>controller</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"sku/list"</span>)</span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;List&lt;Sku&gt;&gt; querySkuBySpuId(<span class="meta">@RequestParam</span>(<span class="string">"id"</span>) Long id) &#123;</span><br><span class="line">    List&lt;Sku&gt; skus = <span class="keyword">this</span>.goodsService.querySkuBySpuId(id);</span><br><span class="line">    <span class="keyword">if</span> (skus == <span class="keyword">null</span> || skus.size() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(HttpStatus.NOT_FOUND);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(skus);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>service</p></blockquote><p>需要注意的是，为了页面回显方便，我们一并把sku的库存stock也查询出来</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Sku&gt; <span class="title">querySkuBySpuId</span><span class="params">(Long spuId)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 查询sku</span></span><br><span class="line">    Sku record = <span class="keyword">new</span> Sku();</span><br><span class="line">    record.setSpuId(spuId);</span><br><span class="line">    List&lt;Sku&gt; skus = <span class="keyword">this</span>.skuMapper.select(record);</span><br><span class="line">    <span class="keyword">for</span> (Sku sku : skus) &#123;</span><br><span class="line">        <span class="comment">// 同时查询出库存</span></span><br><span class="line">        sku.setStock(<span class="keyword">this</span>.stockMapper.selectByPrimaryKey(sku.getId()).getStock());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> skus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>测试：</p></blockquote><p><img src="http://img.smallmartial.cn/QQ%E6%88%AA%E5%9B%BE20190417165042.png" alt="1528875506259"></p><h2 id="2-4-页面回显"><a href="#2-4-页面回显" class="headerlink" title="2.4.页面回显"></a>2.4.页面回显</h2><p>随便点击一个编辑按钮，发现数据回显完成：</p><p><img src="http://img.smallmartial.cn//1528875639346.png" alt="1528875639346"></p><p><img src="http://img.smallmartial.cn//1528875657327.png" alt="1528875657327"></p><p><img src="http://img.smallmartial.cn/1528875725545.png" alt="1528875725545"></p><p> <img src="http://img.smallmartial.cn//1528875747067.png" alt="1528875747067"></p><h2 id="2-5-页面提交"><a href="#2-5-页面提交" class="headerlink" title="2.5.页面提交"></a>2.5.页面提交</h2><p>这里的保存按钮与新增其实是同一个，因此提交的逻辑也是一样的，这里不再赘述。</p><p>随便修改点数据，然后点击保存，可以看到浏览器已经发出请求：</p><p><img src="http://img.smallmartial.cn/1528875903886.png" alt="1528875903886"></p><h2 id="2-6-后台实现"><a href="#2-6-后台实现" class="headerlink" title="2.6.后台实现"></a>2.6.后台实现</h2><p>接下来，我们编写后台，实现修改商品接口。</p><h3 id="2-6-1-Controller"><a href="#2-6-1-Controller" class="headerlink" title="2.6.1.Controller"></a>2.6.1.Controller</h3><ul><li>请求方式：PUT</li><li>请求路径：/</li><li>请求参数：Spu对象</li><li>返回结果：无</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新增商品</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> spu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title">updateGoods</span><span class="params">(@RequestBody SpuBo spu)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.goodsService.update(spu);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(HttpStatus.NO_CONTENT);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(HttpStatus.INTERNAL_SERVER_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-6-2-Service"><a href="#2-6-2-Service" class="headerlink" title="2.6.2.Service"></a>2.6.2.Service</h3><p>spu数据可以修改，但是SKU数据无法修改，因为有可能之前存在的SKU现在已经不存在了，或者以前的sku属性都不存在了。比如以前内存有4G，现在没了。</p><p>因此这里直接删除以前的SKU，然后新增即可。</p><p>代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(SpuBo spu)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 查询以前sku</span></span><br><span class="line">    List&lt;Sku&gt; skus = <span class="keyword">this</span>.querySkuBySpuId(spu.getId());</span><br><span class="line">    <span class="comment">// 如果以前存在，则删除</span></span><br><span class="line">    <span class="keyword">if</span>(!CollectionUtils.isEmpty(skus)) &#123;</span><br><span class="line">        List&lt;Long&gt; ids = skus.stream().map(s -&gt; s.getId()).collect(Collectors.toList());</span><br><span class="line">        <span class="comment">// 删除以前库存</span></span><br><span class="line">        Example example = <span class="keyword">new</span> Example(Stock.class);</span><br><span class="line">        example.createCriteria().andIn(<span class="string">"skuId"</span>, ids);</span><br><span class="line">        <span class="keyword">this</span>.stockMapper.deleteByExample(example);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 删除以前的sku</span></span><br><span class="line">        Sku record = <span class="keyword">new</span> Sku();</span><br><span class="line">        record.setSpuId(spu.getId());</span><br><span class="line">        <span class="keyword">this</span>.skuMapper.delete(record);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 新增sku和库存</span></span><br><span class="line">    saveSkuAndStock(spu.getSkus(), spu.getId());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新spu</span></span><br><span class="line">    spu.setLastUpdateTime(<span class="keyword">new</span> Date());</span><br><span class="line">    spu.setCreateTime(<span class="keyword">null</span>);</span><br><span class="line">    spu.setValid(<span class="keyword">null</span>);</span><br><span class="line">    spu.setSaleable(<span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">this</span>.spuMapper.updateByPrimaryKeySelective(spu);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新spu详情</span></span><br><span class="line">    <span class="keyword">this</span>.spuDetailMapper.updateByPrimaryKeySelective(spu.getSpuDetail());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-6-3-mapper"><a href="#2-6-3-mapper" class="headerlink" title="2.6.3.mapper"></a>2.6.3.mapper</h3><p>与以前一样。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>对于商品模块的管理，在目前所写进度中为复杂繁琐的一块，后端返回的数据需要与前端模板字段一定要对应，在写代码遇到比较困难的地方是对前端所需要的获取的字段与后端不一致。由于对前端vue模版不是特别熟悉，所遇到的问题也是各种奇葩的都有。<br>该项目未实现的模板有:</p><blockquote><p>商品的删除、上下架</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;1-商品修改&quot;&gt;&lt;a href=&quot;#1-商品修改&quot; class=&quot;headerlink&quot; title=&quot;1.商品修改&quot;&gt;&lt;/a&gt;1.商品修改&lt;/h1&gt;&lt;h2 id=&quot;1-1-编辑按钮点击事件&quot;&gt;&lt;a href=&quot;#1-1-编辑按钮点击事件&quot; class=&quot;head
      
    
    </summary>
    
      <category term="乐优商城" scheme="https://github.com/smallmartial/blog.git/categories/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E/"/>
    
    
      <category term="java" scheme="https://github.com/smallmartial/blog.git/tags/java/"/>
    
      <category term="乐优商城" scheme="https://github.com/smallmartial/blog.git/tags/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E/"/>
    
      <category term="springboot" scheme="https://github.com/smallmartial/blog.git/tags/springboot/"/>
    
  </entry>
  
  <entry>
    <title>乐优商城学习笔记七-商品管理（添加商品）</title>
    <link href="https://github.com/smallmartial/blog.git/2019/04/17/lyshop-7/"/>
    <id>https://github.com/smallmartial/blog.git/2019/04/17/lyshop-7/</id>
    <published>2019-04-17T08:18:10.000Z</published>
    <updated>2019-04-17T08:45:00.201Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0-学习目标"><a href="#0-学习目标" class="headerlink" title="0.学习目标"></a>0.学习目标</h1><ul><li>独立实现商品新增后台</li><li>独立实现商品编辑后台</li><li>独立搭建前台系统页面</li></ul><h1 id="1-商品新增"><a href="#1-商品新增" class="headerlink" title="1.商品新增"></a>1.商品新增</h1><h2 id="1-1-页面预览"><a href="#1-1-页面预览" class="headerlink" title="1.1.页面预览"></a>1.1.页面预览</h2><p>当我们点击新增商品按钮：</p><p> <img src="http://img.smallmartial.cn/1528083727447.png" alt="1528083727447"></p><p>就会出现一个弹窗：</p><p><img src="http://img.smallmartial.cn//1528086595597.png" alt="1528086595597"></p><p>里面把商品的数据分为了4部分来填写：</p><ul><li>基本信息：主要是一些简单的文本数据，包含了SPU和SpuDetail的部分数据，如<ul><li>商品分类：是SPU中的<code>cid1</code>，<code>cid2</code>，<code>cid3</code>属性</li><li>品牌：是spu中的<code>brandId</code>属性</li><li>标题：是spu中的<code>title</code>属性</li><li>子标题：是spu中的<code>subTitle</code>属性</li><li>售后服务：是SpuDetail中的<code>afterService</code>属性</li><li>包装列表：是SpuDetail中的<code>packingList</code>属性</li></ul></li><li>商品描述：是SpuDetail中的<code>description</code>属性，数据较多，所以单独放一个页面</li><li>规格参数：商品规格信息，对应SpuDetail中的<code>genericSpec</code>属性</li><li>SKU属性：spu下的所有Sku信息</li></ul><p>对应到页面中的四个<code>stepper-content</code>：</p><p> <img src="http://img.smallmartial.cn//1528102363342.png" alt="1528102363342"></p><h2 id="1-2-弹窗事件"><a href="#1-2-弹窗事件" class="headerlink" title="1.2.弹窗事件"></a>1.2.弹窗事件</h2><p>弹窗是一个独立组件：</p><p> <img src="http://img.smallmartial.cn//1528084394245.png" alt="1528084394245"></p><p>并且在Goods组件中已经引用它：</p><p> <img src="http://img.smallmartial.cn//1528084463927.png" alt="1528084463927"></p><p>并且在页面中渲染：</p><p> <img src="http://img.smallmartial.cn//1529806981038.png" alt="1529806981038"></p><p>在<code>新增商品</code>按钮的点击事件中，改变这个<code>dialog</code>的<code>show</code>属性：</p><p> <img src="http://img.smallmartial.cn//1528084601205.png" alt="1528084601205"></p><p> <img src="http://img.smallmartial.cn//1528084678549.png" alt="1528084678549"></p><h2 id="1-3-基本数据"><a href="#1-3-基本数据" class="headerlink" title="1.3.基本数据"></a>1.3.基本数据</h2><p>我们先来看下基本数据：</p><p><img src="http://img.smallmartial.cn//1528086595597.png" alt="1528086595597"></p><h3 id="1-3-1-商品分类"><a href="#1-3-1-商品分类" class="headerlink" title="1.3.1.商品分类"></a>1.3.1.商品分类</h3><p>商品分类信息查询我们之前已经做过，所以这里的级联选框已经实现完成：</p><p><img src="http://img.smallmartial.cn//1528101303110.png" alt="1528101303110"></p><p>刷新页面，可以看到请求已经发出：</p><p> <img src="http://img.smallmartial.cn//1528101483023.png" alt="1528101483023"></p><p> <img src="http://img.smallmartial.cn//1528101622952.png" alt="1528101622952"></p><p> <img src="http://img.smallmartial.cn//1528101649596.png" alt="1528101649596"></p><h3 id="1-3-2-品牌选择"><a href="#1-3-2-品牌选择" class="headerlink" title="1.3.2.品牌选择"></a>1.3.2.品牌选择</h3><h4 id="页面"><a href="#页面" class="headerlink" title="页面"></a>页面</h4><p>品牌也是一个下拉选框，不过其选项是不确定的，只有当用户选择了商品分类，才会把这个分类下的所有品牌展示出来。</p><p>所以页面编写了watch函数，监控商品分类的变化，每当商品分类值有变化，就会发起请求，查询品牌列表：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"goods.categories"</span>: &#123;</span><br><span class="line">  deep: <span class="literal">true</span>,</span><br><span class="line">  handler(val) &#123;</span><br><span class="line">    <span class="comment">// 判断商品分类是否存在，存在才查询</span></span><br><span class="line">    <span class="keyword">if</span> (val &amp;&amp; val.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">// 根据分类查询品牌</span></span><br><span class="line">      <span class="keyword">this</span>.$http</span><br><span class="line">        .get(<span class="string">"/item/brand/cid/"</span> + <span class="keyword">this</span>.goods.categories[<span class="number">2</span>].id)</span><br><span class="line">        .then(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>.brandOptions = data;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure><p>刷新页面，可以看到请求发起：</p><p> <img src="http://img.smallmartial.cn//1528102075895.png" alt="1528102075895"></p><p>接下来，我们只要编写后台接口，根据商品分类id，查询对应品牌即可。</p><h4 id="后台接口"><a href="#后台接口" class="headerlink" title="后台接口"></a>后台接口</h4><p>页面需要去后台查询品牌信息，我们自然需要提供：</p><blockquote><p>controller</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 根据分类查询品牌</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> cid</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"cid/&#123;cid&#125;"</span>)</span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;List&lt;Brand&gt;&gt; queryBrandByCategory(<span class="meta">@PathVariable</span>(<span class="string">"cid"</span>) Long cid) &#123;</span><br><span class="line">    List&lt;Brand&gt; list = <span class="keyword">this</span>.brandService.queryBrandByCategory(cid);</span><br><span class="line">    <span class="keyword">if</span>(list == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">new</span> ResponseEntity&lt;&gt;(HttpStatus.NOT_FOUND);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>service</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Brand&gt; <span class="title">queryBrandByCategory</span><span class="params">(Long cid)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.brandMapper.queryByCategoryId(cid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>mapper</p></blockquote><p>根据分类查询品牌有中间表，需要自己编写Sql：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select</span>(<span class="string">"SELECT b.* FROM tb_category_brand cb LEFT JOIN tb_brand b ON cb.brand_id = b.id WHERE cb.category_id = #&#123;cid&#125;"</span>)</span><br><span class="line"><span class="function">List&lt;Brand&gt; <span class="title">queryByCategoryId</span><span class="params">(Long cid)</span></span>;</span><br></pre></td></tr></table></figure><h2 id="1-4-商品规格参数"><a href="#1-4-商品规格参数" class="headerlink" title="1.4.商品规格参数"></a>1.4.商品规格参数</h2><p>规格参数的查询我们之前也已经编写过接口，因为商品规格参数也是与商品分类绑定，所以需要在商品分类变化后去查询，我们也是通过watch监控来实现：</p><p> <img src="http://img.smallmartial.cn/1529631056153.png" alt="1529631056153"></p><p>可以看到这里是根据商品分类id查询规格参数：SpecParam。我们之前写过一个根据gid（分组id）来查询规格参数的接口，我们可以对其进行扩展：</p><blockquote><h3 id="改造查询规格参数接口"><a href="#改造查询规格参数接口" class="headerlink" title="改造查询规格参数接口"></a>改造查询规格参数接口</h3></blockquote><p>我们在原来的根据 gid（规格组id)查询规格参数的接口上，添加一个参数：cid，即商品分类id。</p><p>等一下， 考虑到以后可能还会根据是否搜索、是否为通用属性等条件过滤，我们多添加几个过滤条件：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/params"</span>)</span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;List&lt;SpecParam&gt;&gt; querySpecParam(</span><br><span class="line">    <span class="meta">@RequestParam</span>(value=<span class="string">"gid"</span>, required = <span class="keyword">false</span>) Long gid,</span><br><span class="line">    <span class="meta">@RequestParam</span>(value=<span class="string">"cid"</span>, required = <span class="keyword">false</span>) Long cid,</span><br><span class="line">    <span class="meta">@RequestParam</span>(value=<span class="string">"searching"</span>, required = <span class="keyword">false</span>) Boolean searching,</span><br><span class="line">    <span class="meta">@RequestParam</span>(value=<span class="string">"generic"</span>, required = <span class="keyword">false</span>) Boolean generic</span><br><span class="line">    )&#123;</span><br><span class="line">        List&lt;SpecParam&gt; list =</span><br><span class="line">                <span class="keyword">this</span>.specificationService.querySpecParams(gid,cid,searching,generic);</span><br><span class="line">        <span class="keyword">if</span>(list == <span class="keyword">null</span> || list.size() == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(HttpStatus.NOT_FOUND);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(list);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>改造service：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;SpecParam&gt; <span class="title">querySpecParams</span><span class="params">(Long gid, Long cid, Boolean searching, Boolean generic)</span> </span>&#123;</span><br><span class="line">    SpecParam param = <span class="keyword">new</span> SpecParam();</span><br><span class="line">    param.setGroupId(gid);</span><br><span class="line">    param.setCid(cid);</span><br><span class="line">    param.setSearching(searching);</span><br><span class="line">    param.setGeneric(generic);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.specParamMapper.select(param);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果param中有属性为null，则不会吧属性作为查询条件，因此该方法具备通用性，即可根据gid查询，也可根据cid查询。</p><p>测试<br><img src="http://img.smallmartial.cn/QQ%E6%88%AA%E5%9B%BE20190417163732.png" alt></p><p>刷新页面测试：</p><p> <img src="http://img.smallmartial.cn//1529631887407.png" alt="1529631887407"></p><h2 id="1-5-SKU信息"><a href="#1-5-SKU信息" class="headerlink" title="1.5.SKU信息"></a>1.5.SKU信息</h2><p>Sku属性是SPU下的每个商品的不同特征，如图：</p><p><img src="http://img.smallmartial.cn/1529656674978.png" alt="1529656674978"></p><p>当我们填写一些属性后，会在页面下方生成一个sku表格，大家可以计算下会生成多少个不同属性的Sku呢？</p><p>当你选择了上图中的这些选项时：</p><ul><li>颜色共2种：夜空黑，绚丽红</li><li>内存共2种：4GB，6GB</li><li>机身存储1种：64GB</li></ul><p>此时会产生多少种SKU呢？ 应该是 2 <em> 2 </em> 1 = 4种，这其实就是在求笛卡尔积。</p><p>我们会在页面下方生成一个sku的表格：</p><p><img src="http://img.smallmartial.cn/1528856353718.png" alt="1528856353718"></p><h2 id="1-7-页面表单提交"><a href="#1-7-页面表单提交" class="headerlink" title="1.7.页面表单提交"></a>1.7.页面表单提交</h2><p>在sku列表的下方，有一个提交按钮：</p><p><img src="http://img.smallmartial.cn//1528860775149.png" alt="1528860775149"></p><p>并且绑定了点击事件：</p><p> <img src="http://img.smallmartial.cn//1528860848276.png" alt="1528860848276"></p><p>点击后会组织数据并向后台提交：</p><p> <img src="http://img.smallmartial.cn//1528861258072.png" alt="1528861258072"></p><p>提交：</p><p> <img src="http://img.smallmartial.cn//1528861282193.png" alt="1528861282193"></p><p>点击提交，查看控制台提交的数据格式：</p><p><img src="http://img.smallmartial.cn//1529667397378.png" alt="1529667397378"></p><ul><li>整体是一个json格式数据，包含Spu表所有数据：<ul><li>brandId：品牌id</li><li>cid1、cid2、cid3：商品分类id</li><li>subTitle：副标题</li><li>title：标题</li><li>spuDetail：是一个json对象，代表商品详情表数据<ul><li>afterService：售后服务</li><li>description：商品描述</li><li>packingList：包装列表</li><li>specialSpec：sku规格属性模板</li><li>genericSpec：通用规格参数</li></ul></li><li>skus：spu下的所有sku数组，元素是每个sku对象：<ul><li>title：标题</li><li>images：图片</li><li>price：价格</li><li>stock：库存</li><li>ownSpec：特有规格参数</li><li>indexes：特有规格参数的下标</li></ul></li></ul></li></ul><h2 id="1-7-后台实现"><a href="#1-7-后台实现" class="headerlink" title="1.7.后台实现"></a>1.7.后台实现</h2><h3 id="实体类"><a href="#实体类" class="headerlink" title="实体类"></a>实体类</h3><blockquote><p>Spu</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Table</span>(name = <span class="string">"tb_spu"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Spu</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> Long brandId;</span><br><span class="line">    <span class="keyword">private</span> Long cid1;<span class="comment">// 1级类目</span></span><br><span class="line">    <span class="keyword">private</span> Long cid2;<span class="comment">// 2级类目</span></span><br><span class="line">    <span class="keyword">private</span> Long cid3;<span class="comment">// 3级类目</span></span><br><span class="line">    <span class="keyword">private</span> String title;<span class="comment">// 标题</span></span><br><span class="line">    <span class="keyword">private</span> String subTitle;<span class="comment">// 子标题</span></span><br><span class="line">    <span class="keyword">private</span> Boolean saleable;<span class="comment">// 是否上架</span></span><br><span class="line">    <span class="keyword">private</span> Boolean valid;<span class="comment">// 是否有效，逻辑删除用</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;<span class="comment">// 创建时间</span></span><br><span class="line">    <span class="keyword">private</span> Date lastUpdateTime;<span class="comment">// 最后修改时间</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>SpuDetail</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Table</span>(name=<span class="string">"tb_spu_detail"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpuDetail</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long spuId;<span class="comment">// 对应的SPU的id</span></span><br><span class="line">    <span class="keyword">private</span> String description;<span class="comment">// 商品描述</span></span><br><span class="line">    <span class="keyword">private</span> String specTemplate;<span class="comment">// 商品特殊规格的名称及可选值模板</span></span><br><span class="line">    <span class="keyword">private</span> String specifications;<span class="comment">// 商品的全局规格属性</span></span><br><span class="line">    <span class="keyword">private</span> String packingList;<span class="comment">// 包装清单</span></span><br><span class="line">    <span class="keyword">private</span> String afterService;<span class="comment">// 售后服务</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Sku</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Table</span>(name = <span class="string">"tb_sku"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sku</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> Long spuId;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String images;</span><br><span class="line">    <span class="keyword">private</span> Long price;</span><br><span class="line">    <span class="keyword">private</span> String ownSpec;<span class="comment">// 商品特殊规格的键值对</span></span><br><span class="line">    <span class="keyword">private</span> String indexes;<span class="comment">// 商品特殊规格的下标</span></span><br><span class="line">    <span class="keyword">private</span> Boolean enable;<span class="comment">// 是否有效，逻辑删除用</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;<span class="comment">// 创建时间</span></span><br><span class="line">    <span class="keyword">private</span> Date lastUpdateTime;<span class="comment">// 最后修改时间</span></span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> Integer stock;<span class="comment">// 库存</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意：这里保存了一个库存字段，在数据库中是另外一张表保存的，方便查询。</p><blockquote><p>Stock</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Table</span>(name = <span class="string">"tb_stock"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Stock</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long skuId;</span><br><span class="line">    <span class="keyword">private</span> Integer seckillStock;<span class="comment">// 秒杀可用库存</span></span><br><span class="line">    <span class="keyword">private</span> Integer seckillTotal;<span class="comment">// 已秒杀数量</span></span><br><span class="line">    <span class="keyword">private</span> Integer stock;<span class="comment">// 正常库存</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><p>四个问题：</p><ul><li><p>请求方式：POST</p></li><li><p>请求路径：/goods</p></li><li><p>请求参数：Spu的json格式的对象，spu中包含spuDetail和Sku集合。这里我们该怎么接收？我们之前定义了一个SpuBo对象，作为业务对象。这里也可以用它，不过需要再扩展spuDetail和skus字段：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpuBo</span> <span class="keyword">extends</span> <span class="title">Spu</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    String cname;<span class="comment">// 商品分类名称</span></span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    String bname;<span class="comment">// 品牌名称</span></span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    SpuDetail spuDetail;<span class="comment">// 商品详情</span></span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    List&lt;Sku&gt; skus;<span class="comment">// sku列表</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>返回类型：无</p></li></ul><p>代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新增商品</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> spu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title">saveGoods</span><span class="params">(@RequestBody Spu spu)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.goodsService.save(spu);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(HttpStatus.CREATED);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(HttpStatus.INTERNAL_SERVER_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意：通过@RequestBody注解来接收Json请求</p><blockquote><p>Service</p></blockquote><p>这里的逻辑比较复杂，我们除了要对SPU新增以外，还要对SpuDetail、Sku、Stock进行保存</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(SpuBo spu)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 保存spu</span></span><br><span class="line">    spu.setSaleable(<span class="keyword">true</span>);</span><br><span class="line">    spu.setValid(<span class="keyword">true</span>);</span><br><span class="line">    spu.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">    spu.setLastUpdateTime(spu.getCreateTime());</span><br><span class="line">    <span class="keyword">this</span>.spuMapper.insert(spu);</span><br><span class="line">    <span class="comment">// 保存spu详情</span></span><br><span class="line">    spu.getSpuDetail().setSpuId(spu.getId());</span><br><span class="line">    <span class="keyword">this</span>.spuDetailMapper.insert(spu.getSpuDetail());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存sku和库存信息</span></span><br><span class="line">    saveSkuAndStock(spu.getSkus(), spu.getId());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">saveSkuAndStock</span><span class="params">(List&lt;Sku&gt; skus, Long spuId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (Sku sku : skus) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!sku.getEnable()) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 保存sku</span></span><br><span class="line">        sku.setSpuId(spuId);</span><br><span class="line">        <span class="comment">// 初始化时间</span></span><br><span class="line">        sku.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">        sku.setLastUpdateTime(sku.getCreateTime());</span><br><span class="line">        <span class="keyword">this</span>.skuMapper.insert(sku);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存库存信息</span></span><br><span class="line">        Stock stock = <span class="keyword">new</span> Stock();</span><br><span class="line">        stock.setSkuId(sku.getId());</span><br><span class="line">        stock.setStock(sku.getStock());</span><br><span class="line">        <span class="keyword">this</span>.stockMapper.insert(stock);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Mapper"><a href="#Mapper" class="headerlink" title="Mapper"></a>Mapper</h3><p>都是通用Mapper，略</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;0-学习目标&quot;&gt;&lt;a href=&quot;#0-学习目标&quot; class=&quot;headerlink&quot; title=&quot;0.学习目标&quot;&gt;&lt;/a&gt;0.学习目标&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;独立实现商品新增后台&lt;/li&gt;
&lt;li&gt;独立实现商品编辑后台&lt;/li&gt;
&lt;li&gt;独立搭建前台系统
      
    
    </summary>
    
      <category term="乐优商城" scheme="https://github.com/smallmartial/blog.git/categories/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E/"/>
    
    
      <category term="java" scheme="https://github.com/smallmartial/blog.git/tags/java/"/>
    
      <category term="乐优商城" scheme="https://github.com/smallmartial/blog.git/tags/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E/"/>
    
      <category term="springboot" scheme="https://github.com/smallmartial/blog.git/tags/springboot/"/>
    
  </entry>
  
  <entry>
    <title>乐优商城学习笔记六-商品管理</title>
    <link href="https://github.com/smallmartial/blog.git/2019/04/16/lyshop-6/"/>
    <id>https://github.com/smallmartial/blog.git/2019/04/16/lyshop-6/</id>
    <published>2019-04-16T01:19:03.000Z</published>
    <updated>2019-04-17T08:21:36.041Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-SPU和SKU数据结构"><a href="#1-SPU和SKU数据结构" class="headerlink" title="1.SPU和SKU数据结构"></a>1.SPU和SKU数据结构</h1><p>规格确定以后，就可以添加商品了,先看下数据库表</p><h2 id="1-1-SPU表"><a href="#1-1-SPU表" class="headerlink" title="1.1.SPU表"></a>1.1.SPU表</h2><h3 id="1-1-1-表结构"><a href="#1-1-1-表结构" class="headerlink" title="1.1.1.表结构"></a>1.1.1.表结构</h3><p>SPU表：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `tb_spu` (</span><br><span class="line">  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &apos;spu id&apos;,</span><br><span class="line">  `title` varchar(255) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;标题&apos;,</span><br><span class="line">  `sub_title` varchar(255) DEFAULT &apos;&apos; COMMENT &apos;子标题&apos;,</span><br><span class="line">  `cid1` bigint(20) NOT NULL COMMENT &apos;1级类目id&apos;,</span><br><span class="line">  `cid2` bigint(20) NOT NULL COMMENT &apos;2级类目id&apos;,</span><br><span class="line">  `cid3` bigint(20) NOT NULL COMMENT &apos;3级类目id&apos;,</span><br><span class="line">  `brand_id` bigint(20) NOT NULL COMMENT &apos;商品所属品牌id&apos;,</span><br><span class="line">  `saleable` tinyint(1) NOT NULL DEFAULT &apos;1&apos; COMMENT &apos;是否上架，0下架，1上架&apos;,</span><br><span class="line">  `valid` tinyint(1) NOT NULL DEFAULT &apos;1&apos; COMMENT &apos;是否有效，0已删除，1有效&apos;,</span><br><span class="line">  `create_time` datetime DEFAULT NULL COMMENT &apos;添加时间&apos;,</span><br><span class="line">  `last_update_time` datetime DEFAULT NULL COMMENT &apos;最后修改时间&apos;,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=208 DEFAULT CHARSET=utf8 COMMENT=&apos;spu表，该表描述的是一个抽象的商品，比如 iphone8&apos;;</span><br></pre></td></tr></table></figure><p>与我们前面分析的基本类似，但是似乎少了一些字段，比如商品描述。</p><p>我们做了表的垂直拆分，将SPU的详情放到了另一张表：tb_spu_detail</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `tb_spu_detail` (</span><br><span class="line">  `spu_id` bigint(20) NOT NULL,</span><br><span class="line">  `description` text COMMENT &apos;商品描述信息&apos;,</span><br><span class="line">  `specifications` varchar(3000) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;全部规格参数数据&apos;,</span><br><span class="line">  `spec_template` varchar(1000) NOT NULL COMMENT &apos;特有规格参数及可选值信息，json格式&apos;,</span><br><span class="line">  `packing_list` varchar(1000) DEFAULT &apos;&apos; COMMENT &apos;包装清单&apos;,</span><br><span class="line">  `after_service` varchar(1000) DEFAULT &apos;&apos; COMMENT &apos;售后服务&apos;,</span><br><span class="line">  PRIMARY KEY (`spu_id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure><p>这张表中的数据都比较大，为了不影响主表的查询效率我们拆分出这张表。</p><p>需要注意的是这两个字段：specifications和spec_template。</p><h3 id="1-1-2-spu中的规格参数"><a href="#1-1-2-spu中的规格参数" class="headerlink" title="1.1.2.spu中的规格参数"></a>1.1.2.spu中的规格参数</h3><p>前面讲过规格参数与商品分类绑定，一个分类下的所有SPU具有类似的规格参数。SPU下的SKU可能会有不同的规格参数，因此我们计划是这样：</p><ul><li>SPU中保存全局的规格参数信息。</li><li>SKU中保存特有规格参数。</li></ul><p>以手机为例，品牌、操作系统等肯定是全局属性，内存、颜色等肯定是特有属性。</p><p>当你确定了一个SPU，比如小米的：红米4X</p><p>全局属性举例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">品牌：小米</span><br><span class="line">型号：红米4X</span><br></pre></td></tr></table></figure><p>特有属性举例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">颜色：[香槟金, 樱花粉, 磨砂黑]</span><br><span class="line">内存：[2G, 3G]</span><br><span class="line">机身存储：[16GB, 32GB]</span><br></pre></td></tr></table></figure><p>来看下我们的 表如何存储这些信息：</p><h4 id="1-1-2-1-specifications字段"><a href="#1-1-2-1-specifications字段" class="headerlink" title="1.1.2.1.specifications字段"></a>1.1.2.1.specifications字段</h4><p>首先是specifications，其中保存全部规格参数信息，因此也是一个json格式：</p><blockquote><p>整体来看：</p></blockquote><p><img src="http://img.smallmartial.cn/1526262279963.png" alt="1526262279963"></p><blockquote><p>展开一组来看</p></blockquote><p> <img src="http://img.smallmartial.cn//1526262389233.png" alt="1526262389233"></p><p>可以看到，与规格参数表中的模板相比，最大的区别就是，这里指定了具体的值，因为商品确定了，其参数值肯定也确定了。</p><blockquote><p>特有属性</p></blockquote><p>刚才看到的是全局属性，那么特有属性在这个字段中如何存储呢？</p><p> <img src="http://img.smallmartial.cn//1526263214087.png" alt="1526263214087"></p><p>我们发现特有属性也是有的，但是，注意看这里是不确定具体值的，因为特有属性只有在SKU中才能确定。这里只是保存了options，所有SKU属性的可选项。</p><p>在哪里会用到这个字段的值呢，商品详情页的规格参数信息中：</p><p> <img src="http://img.smallmartial.cn//1526267700765.png" alt="1526267700765"></p><h4 id="1-1-2-2-spec-template字段"><a href="#1-1-2-2-spec-template字段" class="headerlink" title="1.1.2.2.spec_template字段"></a>1.1.2.2.spec_template字段</h4><p>既然specifications已经包含了所有的规格参数，那么为什么又多出了一个spec_template呢？</p><p>里面又有哪些内容呢？</p><p>来看数据格式：</p><p> <img src="http://img.smallmartial.cn//1526267952827.png" alt="1526267952827"></p><p>可以看出，里面只保存了规格参数中的特有属性，而且格式进行了大大的简化，只有属性的key，和待选项。</p><p>为什么要冗余保存一份？</p><p>因为很多场景下我们只需要查询特有规格属性，如果放在一起，每次查询再去分离比较麻烦。</p><p>比如，商品详情页展示可选的规格参数时：</p><p>   <img src="http://img.smallmartial.cn/1526267828817.png" alt="1526267828817"></p><h2 id="2-页面实现"><a href="#2-页面实现" class="headerlink" title="2.页面实现"></a>2.页面实现</h2><h3 id="2-1-页面实现代码"><a href="#2-1-页面实现代码" class="headerlink" title="2.1.页面实现代码"></a>2.1.页面实现代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">v-card</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">v-card-title</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">v-btn</span> <span class="attr">color</span>=<span class="string">"primary"</span> @<span class="attr">click</span>=<span class="string">"addGoods"</span>&gt;</span>新增商品<span class="tag">&lt;/<span class="name">v-btn</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--搜索框，与search属性关联--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">v-spacer</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">v-text-field</span> <span class="attr">label</span>=<span class="string">"输入关键字搜索"</span> <span class="attr">v-model.lazy</span>=<span class="string">"search"</span> <span class="attr">append-icon</span>=<span class="string">"search"</span> <span class="attr">hide-details</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">v-card-title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">v-divider</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">v-data-table</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:headers</span>=<span class="string">"headers"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:items</span>=<span class="string">"goodsList"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:search</span>=<span class="string">"search"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:pagination.sync</span>=<span class="string">"pagination"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:total-items</span>=<span class="string">"totalGoods"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:loading</span>=<span class="string">"loading"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"elevation-1"</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot</span>=<span class="string">"items"</span> <span class="attr">slot-scope</span>=<span class="string">"props"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; props.item.id &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"text-xs-center"</span>&gt;</span>&#123;&#123; props.item.title &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"text-xs-center"</span>&gt;</span>&#123;&#123;props.item.cname&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"text-xs-center"</span>&gt;</span>&#123;&#123; props.item.bname &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"justify-center layout"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">v-btn</span> <span class="attr">color</span>=<span class="string">"info"</span> @<span class="attr">click</span>=<span class="string">"editGoods(props.item)"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">v-btn</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">v-btn</span> <span class="attr">color</span>=<span class="string">"warning"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">v-btn</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">v-btn</span> &gt;</span>下架<span class="tag">&lt;/<span class="name">v-btn</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">v-data-table</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--弹出的对话框--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">v-dialog</span> <span class="attr">max-width</span>=<span class="string">"500"</span> <span class="attr">v-model</span>=<span class="string">"show"</span> <span class="attr">persistent</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">v-card</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--对话框的标题--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">v-toolbar</span> <span class="attr">dense</span> <span class="attr">dark</span> <span class="attr">color</span>=<span class="string">"primary"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">v-toolbar-title</span>&gt;</span>&#123;&#123;isEdit ? '修改' : '新增'&#125;&#125;商品<span class="tag">&lt;/<span class="name">v-toolbar-title</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">v-spacer</span>/&gt;</span></span><br><span class="line">          <span class="comment">&lt;!--关闭窗口的按钮--&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">v-btn</span> <span class="attr">icon</span> @<span class="attr">click</span>=<span class="string">"closeWindow"</span>&gt;</span><span class="tag">&lt;<span class="name">v-icon</span>&gt;</span>close<span class="tag">&lt;/<span class="name">v-icon</span>&gt;</span><span class="tag">&lt;/<span class="name">v-btn</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">v-toolbar</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--对话框的内容，表单--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">v-card-text</span> <span class="attr">class</span>=<span class="string">"px-5"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">my-goods-form</span> <span class="attr">:oldGoods</span>=<span class="string">"oldGoods"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">v-card-text</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">v-card</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">v-dialog</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">v-card</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="comment">// 导入自定义的表单组件</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> MyGoodsForm <span class="keyword">from</span> <span class="string">'./MyGoodsForm'</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">"my-goods"</span>,</span></span><br><span class="line"><span class="undefined">    data() &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        search: <span class="string">''</span>, <span class="comment">// 搜索过滤字段</span></span></span><br><span class="line"><span class="javascript">        totalGoods: <span class="number">0</span>, <span class="comment">// 总条数</span></span></span><br><span class="line"><span class="javascript">        goodsList: [], <span class="comment">// 当前页品牌数据</span></span></span><br><span class="line"><span class="javascript">        loading: <span class="literal">true</span>, <span class="comment">// 是否在加载中</span></span></span><br><span class="line"><span class="javascript">        pagination: &#123;&#125;, <span class="comment">// 分页信息</span></span></span><br><span class="line"><span class="undefined">        headers: [</span></span><br><span class="line"><span class="javascript">          &#123;<span class="attr">text</span>: <span class="string">'id'</span>, <span class="attr">align</span>: <span class="string">'center'</span>, <span class="attr">value</span>: <span class="string">'id'</span>&#125;,</span></span><br><span class="line"><span class="javascript">          &#123;<span class="attr">text</span>: <span class="string">'标题'</span>, <span class="attr">align</span>: <span class="string">'center'</span>, <span class="attr">sortable</span>: <span class="literal">false</span>, <span class="attr">value</span>: <span class="string">'title'</span>&#125;,</span></span><br><span class="line"><span class="javascript">          &#123;<span class="attr">text</span>: <span class="string">'商品分类'</span>, <span class="attr">align</span>: <span class="string">'center'</span>, <span class="attr">sortable</span>: <span class="literal">false</span>, <span class="attr">value</span>: <span class="string">'cname'</span>&#125;,</span></span><br><span class="line"><span class="javascript">          &#123;<span class="attr">text</span>: <span class="string">'品牌'</span>, <span class="attr">align</span>: <span class="string">'center'</span>, <span class="attr">value</span>: <span class="string">'bname'</span>, <span class="attr">sortable</span>: <span class="literal">false</span>,&#125;,</span></span><br><span class="line"><span class="javascript">          &#123;<span class="attr">text</span>: <span class="string">'操作'</span>, <span class="attr">align</span>: <span class="string">'center'</span>, <span class="attr">sortable</span>: <span class="literal">false</span>&#125;</span></span><br><span class="line"><span class="undefined">        ],</span></span><br><span class="line"><span class="javascript">        show: <span class="literal">false</span>,<span class="comment">// 控制对话框的显示</span></span></span><br><span class="line"><span class="javascript">        oldGoods: &#123;&#125;, <span class="comment">// 即将被编辑的商品信息</span></span></span><br><span class="line"><span class="javascript">        isEdit: <span class="literal">false</span>, <span class="comment">// 是否是编辑</span></span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="javascript">    mounted() &#123; <span class="comment">// 渲染后执行</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 查询数据</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.getDataFromServer();</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    watch: &#123;</span></span><br><span class="line"><span class="javascript">      pagination: &#123; <span class="comment">// 监视pagination属性的变化</span></span></span><br><span class="line"><span class="javascript">        deep: <span class="literal">true</span>, <span class="comment">// deep为true，会监视pagination的属性及属性中的对象属性变化</span></span></span><br><span class="line"><span class="undefined">        handler() &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 变化后的回调函数，这里我们再次调用getDataFromServer即可</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">this</span>.getDataFromServer();</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;,</span></span><br><span class="line"><span class="javascript">      search: &#123; <span class="comment">// 监视搜索字段</span></span></span><br><span class="line"><span class="undefined">        handler() &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">this</span>.getDataFromServer();</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    methods: &#123;</span></span><br><span class="line"><span class="javascript">      getDataFromServer() &#123; <span class="comment">// 从服务的加载数的方法。</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 发起请求</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.$http.get(<span class="string">"/item/spu/page"</span>, &#123;</span></span><br><span class="line"><span class="undefined">          params: &#123;</span></span><br><span class="line"><span class="javascript">            key: <span class="keyword">this</span>.search, <span class="comment">// 搜索条件</span></span></span><br><span class="line"><span class="javascript">            page: <span class="keyword">this</span>.pagination.page,<span class="comment">// 当前页</span></span></span><br><span class="line"><span class="javascript">            rows: <span class="keyword">this</span>.pagination.rowsPerPage,<span class="comment">// 每页大小</span></span></span><br><span class="line"><span class="javascript">            sortBy: <span class="keyword">this</span>.pagination.sortBy,<span class="comment">// 排序字段</span></span></span><br><span class="line"><span class="javascript">            desc: <span class="keyword">this</span>.pagination.descending<span class="comment">// 是否降序</span></span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="javascript">        &#125;).then(<span class="function"><span class="params">resp</span> =&gt;</span> &#123; <span class="comment">// 这里使用箭头函数</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">this</span>.goodsList = resp.data.items;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">this</span>.totalGoods = resp.data.total;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 完成赋值后，把加载状态赋值为false</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">this</span>.loading = <span class="literal">false</span>;</span></span><br><span class="line"><span class="undefined">        &#125;)</span></span><br><span class="line"><span class="undefined">      &#125;,</span></span><br><span class="line"><span class="undefined">      addGoods() &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 修改标记</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.isEdit = <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 控制弹窗可见：</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.show = <span class="literal">true</span>;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 把oldBrand变为null</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.oldBrand = <span class="literal">null</span>;</span></span><br><span class="line"><span class="undefined">      &#125;,</span></span><br><span class="line"><span class="undefined">      editGoods(oldGoods)&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 修改标记</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.isEdit = <span class="literal">true</span>;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 控制弹窗可见：</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.show = <span class="literal">true</span>;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 获取要编辑的brand</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.oldGoods = oldGoods;</span></span><br><span class="line"><span class="undefined">      &#125;,</span></span><br><span class="line"><span class="undefined">      closeWindow()&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 重新加载数据</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.getDataFromServer();</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 关闭窗口</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.show = <span class="literal">false</span>;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    components:&#123;</span></span><br><span class="line"><span class="undefined">      MyGoodsForm</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>主要的改动点：</p><ul><li><p>页面的<code>v-data-table</code>中的属性绑定修改。items指向goodsList，totalItems指向totalGoods</p></li><li><p>页面渲染的字段名修改：字段改成商品的SPU字段：id、title，cname(商品分类名称),bname（品牌名称）</p></li><li><p>data属性修改了以下属性：</p><ul><li>goodsList：当前页商品数据</li><li>totalGoods：商品总数</li><li>headers：头信息，需要修改头显示名称</li><li>oldGoods：准备要修改的商品</li></ul></li><li><p>加载数据的函数：getDataFromServer，请求的路径进行了修改，另外去除了跟排序相关的查询。SPU查询不排序</p></li><li><p>新增商品的事件函数：清除了一些数据查询接口，只保留弹窗</p></li></ul><p>查看效果：</p><p><img src="http://img.smallmartial.cn/1526272476614.png" alt="1526272476614"></p><h2 id="2-3-后台提供接口"><a href="#2-3-后台提供接口" class="headerlink" title="2.3.后台提供接口"></a>2.3.后台提供接口</h2><p>页面已经准备好，接下来在后台提供分页查询SPU的功能：</p><h3 id="实体类"><a href="#实体类" class="headerlink" title="实体类"></a>实体类</h3><blockquote><p>spu<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"tb_spu"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Spu</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@KeySql</span>(useGeneratedKeys = <span class="keyword">true</span>)</span><br><span class="line"><span class="comment">//    @GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> Long brandId;</span><br><span class="line">    <span class="keyword">private</span> Long cid1;<span class="comment">// 1级类目</span></span><br><span class="line">    <span class="keyword">private</span> Long cid2;<span class="comment">// 2级类目</span></span><br><span class="line">    <span class="keyword">private</span> Long cid3;<span class="comment">// 3级类目</span></span><br><span class="line">    <span class="keyword">private</span> String title;<span class="comment">// 标题</span></span><br><span class="line">    <span class="keyword">private</span> String subTitle;<span class="comment">// 子标题</span></span><br><span class="line">    <span class="keyword">private</span> Boolean saleable;<span class="comment">// 是否上架</span></span><br><span class="line">    <span class="keyword">private</span> Boolean valid;<span class="comment">// 是否有效，逻辑删除用</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;<span class="comment">// 创建时间</span></span><br><span class="line">    <span class="keyword">private</span> Date lastUpdateTime;<span class="comment">// 最后修改时间</span></span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> String cname;</span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> String bname;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>spu详情表<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Table</span>(name=<span class="string">"tb_spu_detail"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpuDetail</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long spuId;<span class="comment">// 对应的SPU的id</span></span><br><span class="line">    <span class="keyword">private</span> String description;<span class="comment">// 商品描述</span></span><br><span class="line">    <span class="keyword">private</span> String specTemplate;<span class="comment">// 商品特殊规格的名称及可选值模板</span></span><br><span class="line">    <span class="keyword">private</span> String specifications;<span class="comment">// 商品的全局规格属性</span></span><br><span class="line">    <span class="keyword">private</span> String packingList;<span class="comment">// 包装清单</span></span><br><span class="line">    <span class="keyword">private</span> String afterService;<span class="comment">// 售后服务</span></span><br><span class="line">    <span class="comment">// 省略getter和setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote><h3 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h3><p>先分析：</p><ul><li><p>请求方式：GET</p></li><li><p>请求路径：/spu/page</p></li><li><p>请求参数：</p><ul><li>page：当前页</li><li>rows：每页大小</li><li>key：过滤条件</li><li>saleable：上架或下架</li></ul></li><li><p>返回结果：商品SPU的分页信息。</p><ul><li><p>要注意，页面展示的是商品分类和品牌名称，而数据库中保存的是id，怎么办？</p><p>我们可以在spu类,拓展cname和bname属性，</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"tb_spu"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Spu</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> String cname;</span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> String bname;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><blockquote><p>代码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> GoodsService goodsService;</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/spu/page"</span>)</span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;PageResult&lt;Spu&gt;&gt; querySpuByPage(</span><br><span class="line">            <span class="meta">@RequestParam</span>(value = <span class="string">"page"</span>,defaultValue = <span class="string">"1"</span>) Integer page,</span><br><span class="line">            <span class="meta">@RequestParam</span>(value = <span class="string">"rows"</span>,defaultValue = <span class="string">"5"</span>) Integer rows,</span><br><span class="line">            <span class="meta">@RequestParam</span>(value = <span class="string">"sortBy"</span>, required = <span class="keyword">false</span>) String sortBy,</span><br><span class="line">            <span class="meta">@RequestParam</span>(value = <span class="string">"desc"</span>, defaultValue = <span class="string">"false"</span>) Boolean desc,</span><br><span class="line">            <span class="meta">@RequestParam</span>(value = <span class="string">"key"</span>,required = <span class="keyword">false</span>) String key,</span><br><span class="line">            <span class="meta">@RequestParam</span>(value = <span class="string">"saleable"</span>,defaultValue = <span class="string">"true"</span>) Boolean saleable</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    )&#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(goodsService.querySpuByPage(page,rows,saleable,key));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote><h3 id="service"><a href="#service" class="headerlink" title="service"></a>service</h3><p>所有商品相关的业务（包括SPU和SKU）放到一个业务下：GoodsService。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SpuMapper spuMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SpuDetailMapper spuDetailMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CategoryService categoryService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BrandService brandService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PageResult&lt;Spu&gt; <span class="title">querySpuByPage</span><span class="params">(Integer page, Integer rows, Boolean saleable, String key)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//分页</span></span><br><span class="line">        PageHelper.startPage(page,rows);</span><br><span class="line">        <span class="comment">//过滤</span></span><br><span class="line">        Example example = <span class="keyword">new</span> Example(Spu.class);</span><br><span class="line">        Example.Criteria criterion = example.createCriteria();</span><br><span class="line">        <span class="comment">//搜索字段过滤</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(key))&#123;</span><br><span class="line">            criterion.andLike(<span class="string">"title"</span>,<span class="string">"%"</span>+key+<span class="string">"%"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//上下架过滤</span></span><br><span class="line">        <span class="keyword">if</span> (saleable != <span class="keyword">null</span>)&#123;</span><br><span class="line">            criterion.orEqualTo(<span class="string">"saleable"</span>,saleable);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//排序</span></span><br><span class="line">        example.setOrderByClause(<span class="string">"last_update_time DESC"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询</span></span><br><span class="line">        List&lt;Spu&gt; spus = spuMapper.selectByExample(example);</span><br><span class="line">        <span class="comment">//判断</span></span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(spus))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> LyException(ExceptionEnum.GOODS_NOT_FOOD);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//解析分类和品牌的名称</span></span><br><span class="line">        loadCategoryAndBrandName(spus);</span><br><span class="line">        <span class="comment">//解析分页结果</span></span><br><span class="line">        PageInfo&lt;Spu&gt; info = <span class="keyword">new</span> PageInfo&lt;&gt;(spus);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PageResult&lt;&gt;(info.getTotal(),spus);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">loadCategoryAndBrandName</span><span class="params">(List&lt;Spu&gt; spus)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Spu spu:spus)&#123;</span><br><span class="line">            <span class="comment">//处理分类名称</span></span><br><span class="line">            List&lt;String&gt; names = categoryService.queryByIds(Arrays.asList(spu.getCid1(), spu.getCid2(), spu.getCid3()))</span><br><span class="line">                    .stream().map(Category::getName).collect(Collectors.toList());</span><br><span class="line">            spu.setCname(StringUtils.join(names,<span class="string">"/"</span>));</span><br><span class="line">            <span class="comment">//处理品牌信息</span></span><br><span class="line">            spu.setBname(brandService.queryById(spu.getBrandId()).getName());</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="mapper"><a href="#mapper" class="headerlink" title="mapper"></a>mapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpuMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">Spu</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Category中拓展查询名称的功能"><a href="#Category中拓展查询名称的功能" class="headerlink" title="Category中拓展查询名称的功能"></a>Category中拓展查询名称的功能</h3><p>页面需要商品的分类名称需要在这里查询，因此要额外提供查询分类名称的功能，</p><p>在CategoryService中添加功能：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">queryByIds</span><span class="params">(List&lt;Long&gt; ids)</span></span>&#123;</span><br><span class="line">    List&lt;Category&gt; categories = categoryMapper.selectByIdList(ids);</span><br><span class="line">    <span class="keyword">if</span> (CollectionUtils.isEmpty(categories))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> LyException(ExceptionEnum.CATEGORY_NOT_FOND);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> categories;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>mapper的selectByIDList方法是来自于通用mapper。不过需要我们在mapper上继承一个通用mapper接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">Category</span>&gt;, <span class="title">IdListMapper</span> &lt;<span class="title">Category</span>,<span class="title">Long</span>&gt;</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p> <img src="http://img.smallmartial.cn/1526280777975.png" alt="1526280777975"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;1-SPU和SKU数据结构&quot;&gt;&lt;a href=&quot;#1-SPU和SKU数据结构&quot; class=&quot;headerlink&quot; title=&quot;1.SPU和SKU数据结构&quot;&gt;&lt;/a&gt;1.SPU和SKU数据结构&lt;/h1&gt;&lt;p&gt;规格确定以后，就可以添加商品了,先看下数据库表&lt;/p
      
    
    </summary>
    
      <category term="乐优商城" scheme="https://github.com/smallmartial/blog.git/categories/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E/"/>
    
    
      <category term="java" scheme="https://github.com/smallmartial/blog.git/tags/java/"/>
    
      <category term="乐优商城" scheme="https://github.com/smallmartial/blog.git/tags/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E/"/>
    
      <category term="springboot" scheme="https://github.com/smallmartial/blog.git/tags/springboot/"/>
    
  </entry>
  
  <entry>
    <title>乐优商城学习笔记五-商品规格管理</title>
    <link href="https://github.com/smallmartial/blog.git/2019/04/15/lyshop-5/"/>
    <id>https://github.com/smallmartial/blog.git/2019/04/15/lyshop-5/</id>
    <published>2019-04-15T05:29:57.000Z</published>
    <updated>2019-04-15T07:35:49.290Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0-学习目标"><a href="#0-学习目标" class="headerlink" title="0.学习目标"></a>0.学习目标</h1><ul><li>了解商品规格数据结构设计思路</li><li>实现商品规格查询</li><li>了解SPU和SKU数据结构设计思路</li><li>实现商品查询</li><li>了解商品新增的页面实现</li><li>独立编写商品新增后台功能</li></ul><h1 id="1-商品规格数据结构"><a href="#1-商品规格数据结构" class="headerlink" title="1.商品规格数据结构"></a>1.商品规格数据结构</h1><p>乐优商城是一个全品类的电商网站，因此商品的种类繁多，每一件商品，其属性又有差别。为了更准确描述商品及细分差别，抽象出两个概念：SPU和SKU，了解一下：</p><h2 id="1-1-SPU和SKU"><a href="#1-1-SPU和SKU" class="headerlink" title="1.1.SPU和SKU"></a>1.1.SPU和SKU</h2><p>SPU：Standard Product Unit （标准产品单位） ，一组具有共同属性的商品集</p><p>SKU：Stock Keeping Unit（库存量单位），SPU商品集因具体特性不同而细分的每个商品</p><p>以图为例来看：<br><img src="http://img.smallmartial.cn/1526085541996.png" alt="1526085541996"></p><ul><li>本页的 华为Mate10 就是一个商品集（SPU）</li><li>因为颜色、内存等不同，而细分出不同的Mate10，如亮黑色128G版。（SKU）</li></ul><p>可以看出：</p><ul><li>SPU是一个抽象的商品集概念，为了方便后台的管理。</li><li>SKU才是具体要销售的商品，每一个SKU的价格、库存可能会不一样，用户购买的是SKU而不是SPU</li></ul><h2 id="1-2-数据库设计分析"><a href="#1-2-数据库设计分析" class="headerlink" title="1.2.数据库设计分析"></a>1.2.数据库设计分析</h2><h3 id="1-2-1-思考并发现问题"><a href="#1-2-1-思考并发现问题" class="headerlink" title="1.2.1.思考并发现问题"></a>1.2.1.思考并发现问题</h3><p>弄清楚了SPU和SKU的概念区分，接下来我们一起思考一下该如何设计数据库表。</p><p>首先来看SPU，大家一起思考下SPU应该有哪些字段来描述？</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">id:主键</span><br><span class="line">title：标题</span><br><span class="line">description：描述</span><br><span class="line">specification：规格</span><br><span class="line">packaging_list：包装</span><br><span class="line">after_service：售后服务</span><br><span class="line">comment：评价</span><br><span class="line">category_id：商品分类</span><br><span class="line">brand_id：品牌</span><br></pre></td></tr></table></figure><p>似乎并不复杂，但是大家仔细思考一下，商品的规格字段你如何填写？</p><p> <img src="http://img.smallmartial.cn/1526086539789.png" alt="1526086539789"></p><p>不同商品的规格不一定相同，数据库中要如何保存？</p><p>再看下SKU，大家觉得应该有什么字段？</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">id：主键</span><br><span class="line">spu_id：关联的spu</span><br><span class="line">price：价格</span><br><span class="line">images：图片</span><br><span class="line">stock：库存</span><br><span class="line">颜色？</span><br><span class="line">内存？</span><br><span class="line">硬盘？</span><br></pre></td></tr></table></figure><p>碰到难题了，不同的商品分类，可能属性是不一样的，比如手机有内存，衣服有尺码，我们是全品类的电商网站，这些不同的商品的不同属性，如何设计到一张表中？</p><h3 id="1-2-2-分析规格参数"><a href="#1-2-2-分析规格参数" class="headerlink" title="1.2.2.分析规格参数"></a>1.2.2.分析规格参数</h3><p>仔细查看每一种商品的规格你会发现：</p><p>虽然商品规格千变万化，但是同一类商品（如手机）的规格是统一的，有图为证：</p><blockquote><p>华为的规格：</p></blockquote><p> <img src="http://img.smallmartial.cn/1526087063700.png" alt="1526087063700"></p><blockquote><p>三星的规格：</p></blockquote><p> <img src="http://img.smallmartial.cn/1526087142454.png" alt="1526087142454"></p><p>也就是说，商品的规格参数应该是与分类绑定的。<strong>每一个分类都有统一的规格参数模板，但不同商品其参数值可能不同</strong>。</p><p>如下图所示：</p><p> <img src="http://img.smallmartial.cn/1526088168565.png" alt="1526088168565"></p><h3 id="1-2-3-SKU的特有属性"><a href="#1-2-3-SKU的特有属性" class="headerlink" title="1.2.3.SKU的特有属性"></a>1.2.3.SKU的特有属性</h3><p>SPU中会有一些特殊属性，用来区分不同的SKU，我们称为SKU特有属性。如华为META10的颜色、内存属性。</p><p>不同种类的商品，一个手机，一个衣服，其SKU属性不相同。</p><p>同一种类的商品，比如都是衣服，SKU属性基本是一样的，都是颜色、尺码等。</p><p>这样说起来，似乎SKU的特有属性也是与分类相关的？事实上，仔细观察你会发现，<strong>SKU的特有属性是商品规格参数的一部分</strong>：</p><p><img src="http://img.smallmartial.cn/1526088981953.png" alt="1526088981953"></p><p>也就是说，我们没必要单独对SKU的特有属性进行设计，它可以看做是规格参数中的一部分。这样规格参数中的属性可以标记成两部分：</p><ul><li>所有sku共享的规格属性（称为全局属性）</li><li>每个sku不同的规格属性（称为特有属性）</li></ul><p><img src="http://img.smallmartial.cn/1526089506566.png" alt="1526089506566"></p><h3 id="1-2-4-搜索属性"><a href="#1-2-4-搜索属性" class="headerlink" title="1.2.4.搜索属性"></a>1.2.4.搜索属性</h3><p>打开一个搜索页，我们来看看过滤的条件：</p><p><img src="http://img.smallmartial.cn/1526090072535.png" alt="1526090072535"></p><p>你会发现，过滤条件中的屏幕尺寸、运行内存、网路、机身内存、电池容量、CPU核数等，在规格参数中都能找到：</p><p> <img src="http://img.smallmartial.cn/1526090228171.png" alt="1526090228171"></p><p>也就是说，规格参数中的数据，将来会有一部分作为搜索条件来使用。我们可以在设计时，将这部分属性标记出来，将来做搜索的时候，作为过滤条件。要注意的是，无论是SPU的全局属性，还是SKU的特有属性，都有可能作为搜索过滤条件的，并不冲突，而是有一个交集：</p><p> <img src="http://img.smallmartial.cn/1526091216124.png" alt="1526091216124"></p><h2 id="1-3-规格参数表"><a href="#1-3-规格参数表" class="headerlink" title="1.3.规格参数表"></a>1.3.规格参数表</h2><h3 id="1-3-1-表结构"><a href="#1-3-1-表结构" class="headerlink" title="1.3.1.表结构"></a>1.3.1.表结构</h3><p>先看下规格参数表：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `tb_specification` (</span><br><span class="line">  `category_id` bigint(20) NOT NULL COMMENT &apos;规格模板所属商品分类id&apos;,</span><br><span class="line">  `specifications` varchar(3000) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;规格参数模板，json格式&apos;,</span><br><span class="line">  PRIMARY KEY (`category_id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=&apos;商品规格参数模板，json格式。&apos;;</span><br></pre></td></tr></table></figure><p>很奇怪是吧，只有两个字段。特别需要注意的是第二个字段：</p><ul><li>specificatons：规格参数模板，json格式</li></ul><p>为什么是一个json？我们看下规格参数的格式：</p><p><img src="http://img.smallmartial.cn/1526092179381.png" alt="1526092179381"></p><p>如果按照传统数据库设计，这里至少需要3张表：</p><ul><li>group：代表组，与商品分类关联</li><li>param_key：属性名，与组关联，一对多</li><li>param_value：属性备选值，与属性名关联，一对多</li></ul><p>这样程序的复杂度大大增加，但是提高了数据的复用性。</p><p>我们的解决方案是，采用json来保存整个规格参数模板，不需要额外的表，一个字符串就够了。</p><h3 id="1-3-2-json结构分析"><a href="#1-3-2-json结构分析" class="headerlink" title="1.3.2.json结构分析"></a>1.3.2.json结构分析</h3><blockquote><p>先整体看一下：</p></blockquote><p> <img src="http://img.smallmartial.cn/1526092693138.png" alt="1526092693138"></p><ul><li>因为规格参数分为很多组，所以json最外层是一个数组。</li><li>数组中是对象类型，每个对象代表一个组的数据，对象的属性包括：<ul><li>group：组的名称</li><li>params：该组的所有属性</li></ul></li></ul><blockquote><p>接下来是params：</p></blockquote><p> <img src="http://img.smallmartial.cn/1526093111370.png" alt="1526093111370"></p><p>以<code>主芯片</code>这一组为例：</p><ul><li><p>group：注明，这里是主芯片</p></li><li><p>params：该组的所有规格属性，因为不止一个，所以是一个数组。这里包含四个规格属性：CPU品牌，CPU型号，CPU频率，CPU核数。每个规格属性都是一个对象，包含以下信息：</p><ul><li>k：属性名称</li><li>searchable：是否作为搜索字段，将来在搜索页面使用，boolean类型</li><li>global：是否是SPU全局属性，boolean类型。true为全局属性，false为SKU的特有属性</li><li>options：属性值的可选项，数组结构。起约束作用，不允许填写可选项以外的值，比如CPU核数，有人添10000核岂不是很扯淡</li><li>numerical：是否为数值，boolean类型，true则为数值，false则不是。为空也代表非数值</li><li>unit：单位，如：克，毫米。如果是数值类型，那么就需要有单位，否则可以不填。</li></ul></li></ul><p>上面的截图中所有属性都是全局属性，我们来看看内存，应该是特有属性：</p><p>  <img src="http://img.smallmartial.cn/1526262641446.png" alt="1526262641446"></p><p>总结下：</p><ul><li>规格参数分组，每组有多个参数</li><li>参数的 <code>k</code>代表属性名称，没有值，具体的SPU才能确定值</li><li>参数会有不同的属性：是否可搜索，是否是全局、是否是数值，这些都用boolean值进行标记：<ul><li>SPU下的多个SKU共享的参数称为全局属性，用<code>global</code>标记</li><li>SPU下的多个SKU特有的参数称为特有属性</li><li>如果参数是数值类型，用<code>numerical</code>标记，并且指定单位<code>unit</code></li><li>如果参数可搜索，用<code>searchable</code>标记<h1 id="2-商品规格参数管理"><a href="#2-商品规格参数管理" class="headerlink" title="2.商品规格参数管理"></a>2.商品规格参数管理</h1></li></ul></li></ul><h2 id="2-1-1-页面实现"><a href="#2-1-1-页面实现" class="headerlink" title="2.1.1.页面实现"></a>2.1.1.页面实现</h2><p>因为规格是跟商品分类绑定的，因此首先会展现商品分类树，并且提示你要选择商品分类，才能看到规格参数的模板。一起了解下页面的实现：</p><p><img src="http://img.smallmartial.cn/1526095548672.png" alt="1526095548672"></p><p>可以看出页面分成3个部分：</p><ul><li><p><code>v-card-title</code>：标题部分，这里是提示信息，告诉用户要先选择分类，才能看到模板</p></li><li><p><code>v-tree</code>：这里用到的是我们之前讲过的树组件，展示商品分类树，不过现在是假数据，我们只要把<code>treeData</code>属性删除，它就会走<code>url</code>属性指定的路径去查询真实的商品分类树了。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;v-tree url=<span class="string">"/item/category/list"</span> :isEdit=<span class="string">"false"</span>  @handleClick=<span class="string">"handleClick"</span> /&gt;</span><br></pre></td></tr></table></figure></li><li><p><code>v-dialog</code>：Vuetify提供的对话框组件，v-model绑定的dialog属性是boolean类型：</p><ul><li>true则显示弹窗</li><li>false则隐藏弹窗</li></ul></li></ul><h3 id="2-1-2-data中定义的属性"><a href="#2-1-2-data中定义的属性" class="headerlink" title="2.1.2.data中定义的属性"></a>2.1.2.data中定义的属性</h3><p>接下来，看看Vue实例中data定义了哪些属性，对页面会产生怎样的影响：</p><p> <img src="http://img.smallmartial.cn//1526287774316.png" alt="1526287774316"></p><ul><li>specifications：选中一个商品分类后，需要查询后台获取规格参数信息，保存在这个对象中，Vue会完成页面渲染。</li><li>oldSpec：当前页兼具了规格的增、改、查等功能，这个对象记录被修改前的规格参数，以防用户撤销修改，用来恢复数据。</li><li>dialog：是否显示对话框的标记。true则显示，false则不显示</li><li>currentNode：记录当前选中的商品分类节点</li><li>isInsert：判断接下来是新增还是修改</li></ul><h2 id="2-2-规格参数的查询"><a href="#2-2-规格参数的查询" class="headerlink" title="2.2.规格参数的查询"></a>2.2.规格参数的查询</h2><p>点击树节点后要显示规格参数，因此查询功能应该编写在点击事件中。</p><p>了解一下：</p><h3 id="2-2-1-树节点的点击事件"><a href="#2-2-1-树节点的点击事件" class="headerlink" title="2.2.1.树节点的点击事件"></a>2.2.1.树节点的点击事件</h3><p>当我们点击树节点时，要将<code>v-dialog</code>打开，因此必须绑定一个点击事件：</p><p> <img src="http://img.smallmartial.cn/1526095959539.png" alt="1526095959539"></p><p>我们来看下<code>handleClick</code>方法：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">handleClick(node) &#123;</span><br><span class="line">    <span class="comment">// 判断点击的节点是否是父节点（只有点击到叶子节点才会弹窗）</span></span><br><span class="line">    <span class="keyword">if</span> (!node.isParent) &#123;</span><br><span class="line">        <span class="comment">// 如果是叶子节点，那么就发起ajax请求，去后台查询商品规格数据。</span></span><br><span class="line">        <span class="keyword">this</span>.$http.get(<span class="string">"/item/spec/"</span> + node.id)</span><br><span class="line">            .then(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 查询成功后，把响应结果赋值给specifications属性，Vue会进行自动渲染。</span></span><br><span class="line">            <span class="keyword">this</span>.specifications = resp.data;</span><br><span class="line">            <span class="comment">// 记录下此时的规格数据，当页面撤销修改时，用来恢复原始数据</span></span><br><span class="line">            <span class="keyword">this</span>.oldSpec = resp.data;</span><br><span class="line">            <span class="comment">// 打开弹窗</span></span><br><span class="line">            <span class="keyword">this</span>.dialog = <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">// 标记此时要进行修改操作</span></span><br><span class="line">            <span class="keyword">this</span>.isInsert = <span class="literal">false</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">            .catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 如果没有查询成功，那么询问是否添加规格</span></span><br><span class="line">            <span class="keyword">this</span>.$message.confirm(<span class="string">'该分类还没有规格参数，是否添加?'</span>)</span><br><span class="line">                .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 如果要添加，则将specifications初始化为空</span></span><br><span class="line">                <span class="keyword">this</span>.specifications = [&#123;</span><br><span class="line">                    group: <span class="string">''</span>,</span><br><span class="line">                    params: []</span><br><span class="line">                &#125;];</span><br><span class="line">                <span class="comment">// 打开弹窗</span></span><br><span class="line">                <span class="keyword">this</span>.dialog = <span class="literal">true</span>;</span><br><span class="line">                <span class="comment">// 标记为新增</span></span><br><span class="line">                <span class="keyword">this</span>.isInsert = <span class="literal">true</span>;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-2-后端代码"><a href="#2-2-2-后端代码" class="headerlink" title="2.2.2.后端代码"></a>2.2.2.后端代码</h3><blockquote><p>entity<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"tb_specification"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Specification</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line">    <span class="keyword">private</span> String specifications;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>mapper</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpecificationMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">Specification</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>controller<br>先分析下需要的东西，在页面的ajax请求中可以看出：</p></blockquote><ul><li><p>请求方式：查询，肯定是get</p></li><li><p>请求路径：/spec/{cid} ，这里通过路径占位符传递商品分类的id</p></li><li><p>请求参数：商品分类id</p></li><li><p>返回结果：页面是直接把<code>resp.data</code>赋值给了specifications：</p><p><img src="http://img.smallmartial.cn/1526104087329.png" alt="1526104087329"></p><p>那么我们返回的应该是规格参数的字符串</p></li></ul><p>代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"spec"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpecificationController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SpecificationService specificationService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title">querySpecificationByCategoryId</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Long id)</span>&#123;</span><br><span class="line">        Specification spec = <span class="keyword">this</span>.specificationService.queryById(id);</span><br><span class="line">        <span class="keyword">if</span> (spec == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(HttpStatus.NOT_FOUND);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(spec.getSpecifications());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><blockquote><p>service:</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpecificationService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SpecificationMapper specificationMapper;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Specification <span class="title">queryById</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.specificationMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>页面访问测试：</p></blockquote><p>我们访问：<a href="http://api.leyou.com/api/item/spec/76" target="_blank" rel="noopener">http://api.leyou.com/api/item/spec/76</a><br><img src="http://img.smallmartial.cn/QQ%E6%88%AA%E5%9B%BE20190415152416.png" alt></p><h2 id="2-3-规格参数添加"><a href="#2-3-规格参数添加" class="headerlink" title="2.3 规格参数添加"></a>2.3 规格参数添加</h2><p>###2.3.1 前端代码<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//添加分组</span></span><br><span class="line">addGroup() &#123;</span><br><span class="line">  <span class="keyword">this</span>.specifications.push(&#123;</span><br><span class="line">    group: <span class="string">''</span>,</span><br><span class="line">    params: []</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 添加新模板</span></span><br><span class="line">addParam(i) &#123;</span><br><span class="line">  <span class="keyword">this</span>.specifications[i].params.push(&#123;</span><br><span class="line">    k: <span class="string">""</span>,</span><br><span class="line">    searchable: <span class="literal">false</span>,</span><br><span class="line">    global: <span class="literal">true</span>,</span><br><span class="line">    numerical:<span class="literal">false</span>,</span><br><span class="line">    unit:<span class="string">""</span>,</span><br><span class="line">    options: []</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 添加默认值</span></span><br><span class="line">addOption(i, j) &#123;</span><br><span class="line">  <span class="keyword">this</span>.specifications[i].params[j].options.push(<span class="string">""</span>)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p><p>重点就是saveTemplate函数了，包含对规格模板的增加、修改和删除等功能<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 保存、修改、删除模板</span></span><br><span class="line">      saveTemplate() &#123;</span><br><span class="line">        <span class="keyword">this</span>.dialog = <span class="literal">true</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//模板删除</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.specifications.length === <span class="number">0</span>)&#123;</span><br><span class="line">          <span class="comment">//console.log("删除:"+this.currentNode.id);</span></span><br><span class="line">          <span class="keyword">this</span>.$http.delete(<span class="string">"/item/spec/"</span>+<span class="keyword">this</span>.currentNode.id).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.dialog = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">this</span>.$message.success(<span class="string">"删除成功！"</span>);</span><br><span class="line">            <span class="keyword">this</span>.oldSpec = [];</span><br><span class="line">          &#125;).catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.$message.error(<span class="string">"删除失败"</span>);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>.$http(&#123;</span><br><span class="line">            method: <span class="keyword">this</span>.oldSpec.length === <span class="number">0</span> ? <span class="string">'post'</span> : <span class="string">'put'</span>,</span><br><span class="line">            url: <span class="string">'/item/spec'</span>,</span><br><span class="line">            data: <span class="keyword">this</span>.$qs.stringify(&#123;</span><br><span class="line">              categoryId: <span class="keyword">this</span>.currentNode.id,</span><br><span class="line">              specifications: <span class="built_in">JSON</span>.stringify(<span class="keyword">this</span>.specifications)</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">            .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">this</span>.dialog = <span class="literal">false</span>;</span><br><span class="line">              <span class="keyword">this</span>.$message.success(<span class="string">"保存成功！"</span>)</span><br><span class="line">              <span class="keyword">this</span>.oldSpec = [];</span><br><span class="line">            &#125;)</span><br><span class="line">            .catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">this</span>.$message.error(<span class="string">"保存失败！"</span>)</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></p><p>2.3.2后台</p><blockquote><p>contoller<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *添加规格模板</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> specification</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title">saveSpecification</span><span class="params">(Specification specification)</span></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.specificationService.saveSpecification(specification);</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.status(HttpStatus.OK).build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新规格模板</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> specification</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title">updateSpecification</span><span class="params">(Specification specification)</span></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.specificationService.updateSpecification(specification);</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.status(HttpStatus.OK).build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除规格模板</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@DeleteMapping</span>(<span class="string">"&#123;id&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title">deleteSpecification</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span>Long id)</span>&#123;</span><br><span class="line"></span><br><span class="line">    Specification specification = <span class="keyword">new</span> Specification();</span><br><span class="line">    specification.setCategoryId(id);</span><br><span class="line">    <span class="keyword">this</span>.specificationService.deleteSpecification(specification);</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.status(HttpStatus.OK).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>mapper</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> smallmartial</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2019/4/14</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Email</span> smallmarital@qq.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpecificationMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">Specification</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>service<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveSpecification</span><span class="params">(Specification specification)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.specificationMapper.insert(specification);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateSpecification</span><span class="params">(Specification specification)</span> </span>&#123;</span><br><span class="line">       <span class="comment">/**</span></span><br><span class="line"><span class="comment">        *  updateByPrimaryKeySelective会对字段进行判断再更新(如果为Null就忽略更新)，</span></span><br><span class="line"><span class="comment">        *  如果你只想更新某一字段，可以用这个方法。</span></span><br><span class="line"><span class="comment">        *</span></span><br><span class="line"><span class="comment">        * updateByPrimaryKey对你注入的字段全部更新，</span></span><br><span class="line"><span class="comment">        * 如果为字段不更新，数据库的值就为null。</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       <span class="keyword">this</span>.specificationMapper.updateByPrimaryKeySelective(specification);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteSpecification</span><span class="params">(Specification specification)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.specificationMapper.deleteByPrimaryKey(specification);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p></blockquote><h3 id="2-4测试"><a href="#2-4测试" class="headerlink" title="2.4测试"></a>2.4测试</h3><p><img src="http://img.smallmartial.cn/QQ%E6%88%AA%E5%9B%BE20190415153406.png" alt><br><img src="http://img.smallmartial.cn/QQ%E6%88%AA%E5%9B%BE20190415153440.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;0-学习目标&quot;&gt;&lt;a href=&quot;#0-学习目标&quot; class=&quot;headerlink&quot; title=&quot;0.学习目标&quot;&gt;&lt;/a&gt;0.学习目标&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;了解商品规格数据结构设计思路&lt;/li&gt;
&lt;li&gt;实现商品规格查询&lt;/li&gt;
&lt;li&gt;了解SPU和
      
    
    </summary>
    
      <category term="乐优商城" scheme="https://github.com/smallmartial/blog.git/categories/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E/"/>
    
    
      <category term="java" scheme="https://github.com/smallmartial/blog.git/tags/java/"/>
    
      <category term="乐优商城" scheme="https://github.com/smallmartial/blog.git/tags/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E/"/>
    
      <category term="springboot" scheme="https://github.com/smallmartial/blog.git/tags/springboot/"/>
    
      <category term="FastDFS" scheme="https://github.com/smallmartial/blog.git/tags/FastDFS/"/>
    
  </entry>
  
  <entry>
    <title>乐优商城学习笔记四-FastDFS学习</title>
    <link href="https://github.com/smallmartial/blog.git/2019/04/14/lyshop-4/"/>
    <id>https://github.com/smallmartial/blog.git/2019/04/14/lyshop-4/</id>
    <published>2019-04-14T05:29:48.000Z</published>
    <updated>2019-04-15T07:03:26.642Z</updated>
    
    <content type="html"><![CDATA[<h1 id="FastDFS学习"><a href="#FastDFS学习" class="headerlink" title="FastDFS学习"></a>FastDFS学习</h1><h2 id="1-什么是分布式文件系统"><a href="#1-什么是分布式文件系统" class="headerlink" title="1.什么是分布式文件系统"></a>1.什么是分布式文件系统</h2><p>分布式文件系统（Distributed File System）是指文件系统管理的物理存储资源不一定直接连接在本地节点上，而是通过计算机网络与节点相连。 </p><p>通俗来讲：</p><ul><li>传统文件系统管理的文件就存储在本机。</li><li>分布式文件系统管理的文件存储在很多机器，这些机器通过网络连接，要被统一管理。无论是上传或者访问文件，都需要通过管理中心来访问</li></ul><h2 id="2-什么是FastDFS"><a href="#2-什么是FastDFS" class="headerlink" title="2.什么是FastDFS"></a>2.什么是FastDFS</h2><p>FastDFS是由淘宝的余庆先生所开发的一个轻量级、高性能的开源分布式文件系统。用纯C语言开发，功能丰富：</p><ul><li>文件存储</li><li>文件同步</li><li>文件访问（上传、下载）</li><li>存取负载均衡</li><li>在线扩容</li></ul><p>适合有大容量存储需求的应用或系统。同类的分布式文件系统有谷歌的GFS、HDFS（Hadoop）、TFS（淘宝）等。</p><h3 id="2-1-Ubuntu下安装FastDFS"><a href="#2-1-Ubuntu下安装FastDFS" class="headerlink" title="2.1. Ubuntu下安装FastDFS"></a>2.1. Ubuntu下安装FastDFS</h3><h4 id="2-1-1上传"><a href="#2-1-1上传" class="headerlink" title="2.1.1上传"></a>2.1.1上传</h4><p><img src="http://img.smallmartial.cn/1526205834487.png" alt="1526205834487"></p><h3 id="2-1-2安装依赖"><a href="#2-1-2安装依赖" class="headerlink" title="2.1.2安装依赖"></a>2.1.2安装依赖</h3><h4 id="安装GCC依赖"><a href="#安装GCC依赖" class="headerlink" title="安装GCC依赖"></a>安装GCC依赖</h4><p>GCC用来对C语言代码进行编译运行，使用yum命令安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gcc</span><br></pre></td></tr></table></figure><h4 id="安装unzip工具"><a href="#安装unzip工具" class="headerlink" title="安装unzip工具"></a>安装unzip工具</h4><p>unzip工具可以帮我们对压缩包进行解压</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install unzip zip</span><br></pre></td></tr></table></figure><h4 id="安装libevent"><a href="#安装libevent" class="headerlink" title="安装libevent"></a>安装libevent</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libevent</span><br></pre></td></tr></table></figure><h4 id="安装Nginx所需依赖"><a href="#安装Nginx所需依赖" class="headerlink" title="安装Nginx所需依赖"></a>安装Nginx所需依赖</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install pcre pcre-devel zlib zlib-devel openssl openssl-devel</span><br></pre></td></tr></table></figure><h4 id="安装libfastcommon-master"><a href="#安装libfastcommon-master" class="headerlink" title="安装libfastcommon-master"></a>安装libfastcommon-master</h4><p>这个没有包，只能通过编译安装：</p><ul><li><p>解压刚刚上传的<code>libfastcommon-master.zip</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf libfastcommon-master.zip</span><br></pre></td></tr></table></figure></li><li><p>进入解压完成的目录：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd libfastcommon-master</span><br></pre></td></tr></table></figure></li><li><p>编译并且安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ./make.sh </span><br><span class="line">sudo ./makesh install</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-1-3-安装FastDFS"><a href="#2-1-3-安装FastDFS" class="headerlink" title="2.1.3 安装FastDFS"></a>2.1.3 安装FastDFS</h3><p>这里我们也采用编译安装，步骤与刚才的编译安装方式一样：</p><ul><li><p>解压</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf FastDFS_v5.08.tar.gz</span><br></pre></td></tr></table></figure></li><li><p>进入目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd FastDFS</span><br></pre></td></tr></table></figure></li><li><p>编译并安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ./make.sh </span><br><span class="line">sudo ./make.sh install</span><br></pre></td></tr></table></figure></li><li><p>校验安装结果</p></li></ul><p>1）安装完成，我们应该能在<code>/etc/init.d/</code>目录，通过命令<code>ll /etc/init.d/ | grep fdfs</code>看到FastDFS提供的启动脚本：<br>其中：</p><ul><li><code>fdfs_trackerd</code> 是tracker启动脚本</li><li><p><code>fdfs_storaged</code> 是storage启动脚本<br>2）我们可以在 <code>/etc/fdfs</code>目录，通过命令查看到以下配置文件模板：</p><p><img src="http://img.smallmartial.cn/1524237531578.png" alt="1524237531578"></p></li></ul><p>其中：</p><ul><li><code>tarcker.conf.sample</code> 是tracker的配置文件模板</li><li><code>storage.conf.sample</code> 是storage的配置文件模板</li><li><code>client.conf.sample</code> 是客户端的配置文件模板<h4 id="2-2-启动tracker"><a href="#2-2-启动tracker" class="headerlink" title="2.2 启动tracker"></a>2.2 启动tracker</h4></li></ul><p>FastDFS的tracker和storage在刚刚的安装过程中，都已经被安装了，因此我们安装这两种角色的方式是一样的。不同的是，两种需要不同的配置文件。</p><p>我们要启动tracker，就修改刚刚看到的<code>tarcker.conf</code>，并且启动<code>fdfs_trackerd</code>脚本即可。</p><ul><li>编辑tracker配置</li></ul><p>首先我们将模板文件进行赋值和重命名：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo cp tracker.conf.sample tracker.conf</span><br><span class="line">sudo vim tracker.conf</span><br></pre></td></tr></table></figure><p>打开<code>tracker.conf</code>，修改<code>base_path</code>配置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">base_path=/leyou/fdfs/tracker # tracker的数据和日志存放目录</span><br></pre></td></tr></table></figure><ul><li>创建目录</li></ul><p>刚刚配置的目录可能不存在，我们创建出来</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /leyou/fdfs/tracker</span><br></pre></td></tr></table></figure><ul><li><p>启动tracker</p><p>我们可以使用 <code>sh /etc/init.d/fdfs_trackerd</code> 启动，不过安装过程中，fdfs已经被设置为系统服务，我们可以采用熟悉的服务启动方式：</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service fdfs_trackerd start # 启动fdfs_trackerd服务，停止用stop</span><br></pre></td></tr></table></figure><h4 id="2-3-启动storage"><a href="#2-3-启动storage" class="headerlink" title="2.3 启动storage"></a>2.3 启动storage</h4><p>我们要启动tracker，就修改刚刚看到的<code>tarcker.conf</code>，并且启动<code>fdfs_trackerd</code>脚本即可。</p><ul><li>编辑storage配置</li></ul><p>首先我们将模板文件进行赋值和重命名：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo cp storage.conf.sample storage.conf</span><br><span class="line">sudo vim storage.conf</span><br></pre></td></tr></table></figure><p>打开<code>storage.conf</code>，修改<code>base_path</code>配置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">base_path=/leyou/fdfs/storage # storage的数据和日志存放目录</span><br><span class="line">store_path0=/leyou/fdfs/storage # storage的上传文件存放路径</span><br><span class="line">tracker_server=192.168.56.101:22122 # tracker的地址</span><br></pre></td></tr></table></figure><ul><li>创建目录</li></ul><p>刚刚配置的目录可能不存在，我们创建出来</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /leyou/fdfs/storage</span><br></pre></td></tr></table></figure><ul><li><p>启动storage</p><p>我们可以使用 <code>sh /etc/init.d/fdfs_storaged</code> 启动，同样我们可以用服务启动方式：</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service fdfs_storaged start  # 启动fdfs_storaged服务，停止用stop</span><br></pre></td></tr></table></figure><p>最后，通过<code>ps -ef | grep fdfs</code> 查看进程：</p><p><img src="http://img.smallmartial.cn/1524237414200.png" alt="1524237414200"></p><h3 id="2-4-安装Nginx及FastDFS模块"><a href="#2-4-安装Nginx及FastDFS模块" class="headerlink" title="2.4 安装Nginx及FastDFS模块"></a>2.4 安装Nginx及FastDFS模块</h3><h4 id="2-4-1-FastDFS的Nginx模块"><a href="#2-4-1-FastDFS的Nginx模块" class="headerlink" title="2.4.1 FastDFS的Nginx模块"></a>2.4.1 FastDFS的Nginx模块</h4><ul><li><p>解压</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf fastdfs-nginx-module_v1.16.tar.gz</span><br></pre></td></tr></table></figure></li><li><p>配置config文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 进入配置目录</span><br><span class="line">cd /home/ubuntu/leyou/fdfs/fastdfs-nginx-module/src/</span><br><span class="line"><span class="meta">#</span> 修改配置</span><br><span class="line">vim config</span><br><span class="line"><span class="meta">#</span> 执行下面命令（将配置中的/usr/local改为/usr）：</span><br><span class="line">:%s+/usr/local/+/usr/+g</span><br></pre></td></tr></table></figure><p>​</p></li><li><p>配置mod_fastdfs.conf</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 将src目录下的mod_fastdfs.conf复制到 /etc/fdfs目录：</span><br><span class="line">sudo cp mod_fastdfs.conf /etc/fdfs/</span><br><span class="line"><span class="meta">#</span> 编辑该文件</span><br><span class="line">sudo vim /etc/fdfs/mod_fastdfs.cof</span><br></pre></td></tr></table></figure></li><li><p>修改一下配置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">connect_timeout=10                  # 客户端访问文件连接超时时长（单位：秒）</span><br><span class="line">tracker_server=192.168.56.101:22122  # tracker服务IP和端口</span><br><span class="line">url_have_group_name=true            # 访问链接前缀加上组名</span><br><span class="line">store_path0=/leyou/fdfs/storage        # 文件存储路径</span><br></pre></td></tr></table></figure></li><li><p>复制 FastDFS的部分配置文件到/etc/fdfs目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /home/ubuntu/leyou/fdfs/FastDFS/conf/</span><br><span class="line">cp http.conf mime.types /etc/fdfs/</span><br></pre></td></tr></table></figure></li></ul><h4 id="1-4-2-安装Nginx"><a href="#1-4-2-安装Nginx" class="headerlink" title="1.4.2 安装Nginx"></a>1.4.2 安装Nginx</h4><ul><li><p>解压</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf nginx-1.10.0.tar.gz</span><br></pre></td></tr></table></figure><p>​</p></li><li><p>配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./configure --prefix=/opt/nginx --sbin-path=/usr/bin/nginx --add-module=/home/ubuntu/leyou/fdfs/fastdfs-nginx-module/src</span><br></pre></td></tr></table></figure><p>​</p></li><li><p>编译安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo make &amp;&amp; sudo make install</span><br></pre></td></tr></table></figure><p>​</p></li><li><p>配置nginx整合fastdfs-module模块</p><p>我们需要修改nginx配置文件，在/opt/nginx/config/nginx.conf文件中：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim  /opt/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure><p>将文件中，原来的<code>server 80{ ...}</code> 部分代码替换为如下代码：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  image.taotao.com;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 监听域名中带有group的，交给FastDFS模块处理</span></span><br><span class="line">    <span class="attribute">location</span> ~/group([<span class="number">0</span>-<span class="number">9</span>])/ &#123;</span><br><span class="line">        ngx_fastdfs_module;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span>   html;</span><br><span class="line">        <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">    <span class="attribute">location</span> = /50x.html &#123;</span><br><span class="line">        <span class="attribute">root</span>   html;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nginx # 启动</span><br><span class="line">nginx -s stop # 停止</span><br><span class="line">nginx -s reload # 重新加载配置</span><br></pre></td></tr></table></figure></li></ul><h2 id="3-引入依赖"><a href="#3-引入依赖" class="headerlink" title="3.引入依赖"></a>3.引入依赖</h2><p>在父工程中，我们已经管理了依赖，版本为：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">fastDFS.client.version</span>&gt;</span>1.26.2<span class="tag">&lt;/<span class="name">fastDFS.client.version</span>&gt;</span></span><br></pre></td></tr></table></figure><p>因此，这里我们直接引入坐标即可：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.tobato<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastdfs-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-2-引入配置类"><a href="#3-2-引入配置类" class="headerlink" title="3.2.引入配置类"></a>3.2.引入配置类</h3><p>纯java配置：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import</span>(FdfsClientConfig.class)</span><br><span class="line"><span class="comment">// 解决jmx重复注册bean的问题</span></span><br><span class="line"><span class="meta">@EnableMBeanExport</span>(registration = RegistrationPolicy.IGNORE_EXISTING)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FastClientImporter</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3-编写FastDFS属性"><a href="#3-3-编写FastDFS属性" class="headerlink" title="3.3.编写FastDFS属性"></a>3.3.编写FastDFS属性</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">fdfs:</span></span><br><span class="line"><span class="attr">  so-timeout:</span> <span class="number">1501</span></span><br><span class="line"><span class="attr">  connect-timeout:</span> <span class="number">601</span></span><br><span class="line"><span class="attr">  thumb-image:</span> <span class="comment"># 缩略图</span></span><br><span class="line"><span class="attr">    width:</span> <span class="number">60</span></span><br><span class="line"><span class="attr">    height:</span> <span class="number">60</span></span><br><span class="line"><span class="attr">  tracker-list:</span> <span class="comment"># tracker地址</span></span><br><span class="line"><span class="bullet">    -</span> <span class="number">192.168</span><span class="number">.56</span><span class="number">.101</span><span class="string">:22122</span></span><br></pre></td></tr></table></figure><h3 id="3-4-测试"><a href="#3-4-测试" class="headerlink" title="3.4.测试"></a>3.4.测试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@SpringBootTest</span>(classes = LyUploadService.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FdfsTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FastFileStorageClient storageClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ThumbImageConfig thumbImageConfig;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpload</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">"D:\\test\\baby.png"</span>);</span><br><span class="line">        <span class="comment">// 上传并且生成缩略图</span></span><br><span class="line">        StorePath storePath = <span class="keyword">this</span>.storageClient.uploadFile(</span><br><span class="line">                <span class="keyword">new</span> FileInputStream(file), file.length(), <span class="string">"png"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">// 带分组的路径</span></span><br><span class="line">        System.out.println(storePath.getFullPath());</span><br><span class="line">        <span class="comment">// 不带分组的路径</span></span><br><span class="line">        System.out.println(storePath.getPath());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUploadAndCreateThumb</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">"D:\\test\\baby.png"</span>);</span><br><span class="line">        <span class="comment">// 上传并且生成缩略图</span></span><br><span class="line">        StorePath storePath = <span class="keyword">this</span>.storageClient.uploadImageAndCrtThumbImage(</span><br><span class="line">                <span class="keyword">new</span> FileInputStream(file), file.length(), <span class="string">"png"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">// 带分组的路径</span></span><br><span class="line">        System.out.println(storePath.getFullPath());</span><br><span class="line">        <span class="comment">// 不带分组的路径</span></span><br><span class="line">        System.out.println(storePath.getPath());</span><br><span class="line">        <span class="comment">// 获取缩略图路径</span></span><br><span class="line">        String path = thumbImageConfig.getThumbImagePath(storePath.getPath());</span><br><span class="line">        System.out.println(path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">group1/M00/00/00/CoeGQ1yyzaqAE_U5AAAgsUsN-Oo524.jpg</span><br><span class="line">M00/00/00/CoeGQ1yyzaqAE_U5AAAgsUsN-Oo524.jpg</span><br><span class="line">M00/00/00/CoeGQ1yyzaqAE_U5AAAgsUsN-Oo524_60x60.jpg</span><br></pre></td></tr></table></figure><p><img src="http://img.smallmartial.cn/QQ%E6%88%AA%E5%9B%BE20190414140705.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;FastDFS学习&quot;&gt;&lt;a href=&quot;#FastDFS学习&quot; class=&quot;headerlink&quot; title=&quot;FastDFS学习&quot;&gt;&lt;/a&gt;FastDFS学习&lt;/h1&gt;&lt;h2 id=&quot;1-什么是分布式文件系统&quot;&gt;&lt;a href=&quot;#1-什么是分布式文件系统&quot;
      
    
    </summary>
    
      <category term="乐优商城" scheme="https://github.com/smallmartial/blog.git/categories/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E/"/>
    
    
      <category term="java" scheme="https://github.com/smallmartial/blog.git/tags/java/"/>
    
      <category term="乐优商城" scheme="https://github.com/smallmartial/blog.git/tags/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E/"/>
    
      <category term="springboot" scheme="https://github.com/smallmartial/blog.git/tags/springboot/"/>
    
      <category term="FastDFS" scheme="https://github.com/smallmartial/blog.git/tags/FastDFS/"/>
    
  </entry>
  
  <entry>
    <title>乐优商城学习笔记三-利用cors解决跨域问题</title>
    <link href="https://github.com/smallmartial/blog.git/2019/04/13/lyshop-3/"/>
    <id>https://github.com/smallmartial/blog.git/2019/04/13/lyshop-3/</id>
    <published>2019-04-13T01:59:32.000Z</published>
    <updated>2019-04-15T07:03:25.269Z</updated>
    
    <content type="html"><![CDATA[<h1 id="利用cors解决跨域问题"><a href="#利用cors解决跨域问题" class="headerlink" title="利用cors解决跨域问题"></a>利用cors解决跨域问题</h1><h2 id="1-跨域问题"><a href="#1-跨域问题" class="headerlink" title="1.跨域问题"></a>1.跨域问题</h2><p>跨域：浏览器对于javascript的同源策略的限制 。</p><p>以下情况都属于跨域：</p><table><thead><tr><th>跨域原因说明</th><th>示例</th></tr></thead><tbody><tr><td>域名不同</td><td><code>www.jd.com</code> 与 <code>www.taobao.com</code></td></tr><tr><td>域名相同，端口不同</td><td><code>www.jd.com:8080</code> 与 <code>www.jd.com:8081</code></td></tr><tr><td>二级域名不同</td><td><code>item.jd.com</code> 与 <code>miaosha.jd.com</code></td></tr></tbody></table><p>如果<strong>域名和端口都相同，但是请求路径不同</strong>，不属于跨域，如：</p><p><code>www.jd.com/item</code> </p><p><code>www.jd.com/goods</code></p><p>而我们刚才是从<code>manage.leyou.com</code>去访问<code>api.leyou.com</code>，这属于二级域名不同，跨域了。</p><h2 id="2-为什么有跨域问题？"><a href="#2-为什么有跨域问题？" class="headerlink" title="2.为什么有跨域问题？"></a>2.为什么有跨域问题？</h2><p>跨域不一定会有跨域问题。</p><p>因为跨域问题是浏览器对于ajax请求的一种安全限制：<strong>一个页面发起的ajax请求，只能是与当前页域名相同的路径</strong>，这能有效的阻止跨站攻击。</p><p>因此：<strong>跨域问题 是针对ajax的一种限制</strong>。</p><p>但是这却给我们的开发带来了不便，而且在实际生产环境中，肯定会有很多台服务器之间交互，地址和端口都可能不同，怎么办？</p><h2 id="3-解决跨域问题的方案"><a href="#3-解决跨域问题的方案" class="headerlink" title="3.解决跨域问题的方案"></a>3.解决跨域问题的方案</h2><p>目前比较常用的跨域解决方案有3种：</p><ul><li><p>Jsonp</p><p>最早的解决方案，利用script标签可以跨域的原理实现。</p><p>限制：</p><ul><li>需要服务的支持</li><li>只能发起GET请求</li></ul></li><li><p>nginx反向代理</p><p>思路是：利用nginx把跨域反向代理为不跨域，支持各种请求方式</p><p>缺点：需要在nginx进行额外配置，语义不清晰</p></li><li><p>CORS</p><p>规范化的跨域请求解决方案，安全可靠。</p><p>优势：</p><ul><li>在服务端进行控制是否允许跨域，可自定义规则</li><li>支持各种请求方式</li></ul><p>缺点：</p><ul><li>会产生额外的请求</li></ul></li></ul><p>我们这里会采用<strong>cors的跨域方案</strong>。</p><h2 id="4-cors解决跨域"><a href="#4-cors解决跨域" class="headerlink" title="4.cors解决跨域"></a>4.cors解决跨域</h2><h3 id="4-1-什么是cors"><a href="#4-1-什么是cors" class="headerlink" title="4.1.什么是cors"></a>4.1.什么是cors</h3><p>CORS是一个W3C标准，全称是”跨域资源共享”（Cross-origin resource sharing）。</p><p>它允许浏览器向跨源服务器，发出<a href="http://www.ruanyifeng.com/blog/2012/09/xmlhttprequest_level_2.html" target="_blank" rel="noopener"><code>XMLHttpRequest</code></a>请求，从而克服了AJAX只能<a href="http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html" target="_blank" rel="noopener">同源</a>使用的限制。</p><p>CORS需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE浏览器不能低于IE10。</p><ul><li><p>浏览器端：</p><p>目前，所有浏览器都支持该功能（IE10以下不行）。整个CORS通信过程，都是浏览器自动完成，不需要用户参与。</p></li><li><p>服务端：</p><p>CORS通信与AJAX没有任何差别，因此你不需要改变以前的业务逻辑。只不过，浏览器会在请求中携带一些头信息，我们需要以此判断是否允许其跨域，然后在响应头中加入一些信息即可。这一般通过过滤器完成即可。</p></li></ul><h3 id="4-2-原理有点复杂"><a href="#4-2-原理有点复杂" class="headerlink" title="4.2.原理有点复杂"></a>4.2.原理有点复杂</h3><p>浏览器会将ajax请求分为两类，其处理方案略有差异：简单请求、特殊请求。</p><h4 id="4-2-1-简单请求"><a href="#4-2-1-简单请求" class="headerlink" title="4.2.1.简单请求"></a>4.2.1.简单请求</h4><p>只要同时满足以下两大条件，就属于简单请求。：</p><p>（1) 请求方法是以下三种方法之一：</p><ul><li>HEAD</li><li>GET</li><li>POST</li></ul><p>（2）HTTP的头信息不超出以下几种字段：</p><ul><li>Accept</li><li>Accept-Language</li><li>Content-Language</li><li>Last-Event-ID</li><li>Content-Type：只限于三个值<code>application/x-www-form-urlencoded</code>、<code>multipart/form-data</code>、<code>text/plain</code><br>如果服务器允许跨域，需要在返回的响应头中携带下面信息：</li></ul><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Access-Control-Allow-Origin</span>: http://manage.leyou.com</span><br><span class="line"><span class="attribute">Access-Control-Allow-Credentials</span>: true</span><br><span class="line"><span class="attribute">Content-Type</span>: text/html; charset=utf-8</span><br></pre></td></tr></table></figure><ul><li>Access-Control-Allow-Origin：可接受的域，是一个具体域名或者*（代表任意域名）</li><li>Access-Control-Allow-Credentials：是否允许携带cookie，默认情况下，cors不会携带cookie，除非这个值是true</li></ul><blockquote><p>有关cookie：</p></blockquote><p>要想操作cookie，需要满足3个条件：</p><ul><li>服务的响应头中需要携带Access-Control-Allow-Credentials并且为true。</li><li>浏览器发起ajax需要指定withCredentials 为true</li><li>响应头中的Access-Control-Allow-Origin一定不能为*，必须是指定的域名<h4 id="4-2-2-特殊请求"><a href="#4-2-2-特殊请求" class="headerlink" title="4.2.2.特殊请求"></a>4.2.2.特殊请求</h4></li></ul><p>不符合简单请求的条件，会被浏览器判定为特殊请求,，例如请求方式为PUT。</p><blockquote><p>预检请求</p></blockquote><p>特殊请求会在正式通信之前，增加一次HTTP查询请求，称为”预检”请求（preflight）。</p><p>浏览器先询问服务器，当前网页所在的域名是否在服务器的许可名单之中，以及可以使用哪些HTTP动词和头信息字段。只有得到肯定答复，浏览器才会发出正式的<code>XMLHttpRequest</code>请求，否则就报错。</p><p>一个“预检”请求的样板：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">OPTIONS</span> <span class="string">/cors</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Origin</span>: http://manage.leyou.com</span><br><span class="line"><span class="attribute">Access-Control-Request-Method</span>: PUT</span><br><span class="line"><span class="attribute">Access-Control-Request-Headers</span>: X-Custom-Header</span><br><span class="line"><span class="attribute">Host</span>: api.leyou.com</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US</span><br><span class="line"><span class="attribute">Connection</span>: keep-alive</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0...</span><br></pre></td></tr></table></figure><p>与简单请求相比，除了Origin以外，多了两个头：</p><ul><li>Access-Control-Request-Method：接下来会用到的请求方式，比如PUT</li><li>Access-Control-Request-Headers：会额外用到的头信息</li></ul><blockquote><p>预检请求的响应</p></blockquote><p>服务的收到预检请求，如果许可跨域，会发出响应：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Date</span>: Mon, 01 Dec 2008 01:15:39 GMT</span><br><span class="line"><span class="attribute">Server</span>: Apache/2.0.61 (Unix)</span><br><span class="line"><span class="attribute">Access-Control-Allow-Origin</span>: http://manage.leyou.com</span><br><span class="line"><span class="attribute">Access-Control-Allow-Credentials</span>: true</span><br><span class="line"><span class="attribute">Access-Control-Allow-Methods</span>: GET, POST, PUT</span><br><span class="line"><span class="attribute">Access-Control-Allow-Headers</span>: X-Custom-Header</span><br><span class="line"><span class="attribute">Access-Control-Max-Age</span>: 1728000</span><br><span class="line"><span class="attribute">Content-Type</span>: text/html; charset=utf-8</span><br><span class="line"><span class="attribute">Content-Encoding</span>: gzip</span><br><span class="line"><span class="attribute">Content-Length</span>: 0</span><br><span class="line"><span class="attribute">Keep-Alive</span>: timeout=2, max=100</span><br><span class="line"><span class="attribute">Connection</span>: Keep-Alive</span><br><span class="line"><span class="attribute">Content-Type</span>: text/plain</span><br></pre></td></tr></table></figure><p>除了<code>Access-Control-Allow-Origin</code>和<code>Access-Control-Allow-Credentials</code>以外，这里又额外多出3个头：</p><ul><li>Access-Control-Allow-Methods：允许访问的方式</li><li>Access-Control-Allow-Headers：允许携带的头</li><li>Access-Control-Max-Age：本次许可的有效时长，单位是秒，<strong>过期之前的ajax请求就无需再次进行预检了</strong></li></ul><p>如果浏览器得到上述响应，则认定为可以跨域，后续就跟简单请求的处理是一样的了。</p><h2 id="5-CORS跨域实现"><a href="#5-CORS跨域实现" class="headerlink" title="5. CORS跨域实现"></a>5. CORS跨域实现</h2><p>SpringMVC已经帮我们写好了CORS的跨域过滤器：CorsFilter ,内部已经实现了刚才所讲的判定逻辑，我们直接用就好了。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.smallmartial.gateway.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.CorsConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.UrlBasedCorsConfigurationSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.filter.CorsFilter;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> smallmartial</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2019/4/13</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Email</span> smallmarital@qq.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalCorsConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CorsFilter <span class="title">corsFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.添加CORS配置信息</span></span><br><span class="line">        CorsConfiguration config = <span class="keyword">new</span> CorsConfiguration();</span><br><span class="line">        <span class="comment">//1) 允许的域,不要写*，否则cookie就无法使用了</span></span><br><span class="line">        config.addAllowedOrigin(<span class="string">"http://manage.leyou.com"</span>);</span><br><span class="line">        <span class="comment">//2) 是否发送Cookie信息</span></span><br><span class="line">        config.setAllowCredentials(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//3) 允许的请求方式</span></span><br><span class="line">        config.addAllowedMethod(<span class="string">"OPTIONS"</span>);</span><br><span class="line">        config.addAllowedMethod(<span class="string">"HEAD"</span>);</span><br><span class="line">        config.addAllowedMethod(<span class="string">"GET"</span>);</span><br><span class="line">        config.addAllowedMethod(<span class="string">"PUT"</span>);</span><br><span class="line">        config.addAllowedMethod(<span class="string">"POST"</span>);</span><br><span class="line">        config.addAllowedMethod(<span class="string">"DELETE"</span>);</span><br><span class="line">        config.addAllowedMethod(<span class="string">"PATCH"</span>);</span><br><span class="line">        <span class="comment">// 4）允许的头信息</span></span><br><span class="line">        config.addAllowedHeader(<span class="string">"*"</span>);</span><br><span class="line">        <span class="comment">//5)有效时长</span></span><br><span class="line">        config.setMaxAge(<span class="number">3600L</span>);</span><br><span class="line">        <span class="comment">//2.添加映射路径，我们拦截一切请求</span></span><br><span class="line">        UrlBasedCorsConfigurationSource configSource = <span class="keyword">new</span> UrlBasedCorsConfigurationSource();</span><br><span class="line">        configSource.registerCorsConfiguration(<span class="string">"/**"</span>, config);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.返回新的CorsFilter.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CorsFilter(configSource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;利用cors解决跨域问题&quot;&gt;&lt;a href=&quot;#利用cors解决跨域问题&quot; class=&quot;headerlink&quot; title=&quot;利用cors解决跨域问题&quot;&gt;&lt;/a&gt;利用cors解决跨域问题&lt;/h1&gt;&lt;h2 id=&quot;1-跨域问题&quot;&gt;&lt;a href=&quot;#1-跨域问题&quot;
      
    
    </summary>
    
      <category term="乐优商城" scheme="https://github.com/smallmartial/blog.git/categories/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E/"/>
    
    
      <category term="java" scheme="https://github.com/smallmartial/blog.git/tags/java/"/>
    
      <category term="乐优商城" scheme="https://github.com/smallmartial/blog.git/tags/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E/"/>
    
      <category term="springboot" scheme="https://github.com/smallmartial/blog.git/tags/springboot/"/>
    
  </entry>
  
  <entry>
    <title>乐优商城学习笔记二-通用异常处理</title>
    <link href="https://github.com/smallmartial/blog.git/2019/04/12/lyshop-2/"/>
    <id>https://github.com/smallmartial/blog.git/2019/04/12/lyshop-2/</id>
    <published>2019-04-12T08:56:37.000Z</published>
    <updated>2019-04-15T07:03:23.909Z</updated>
    
    <content type="html"><![CDATA[<h2 id="通用异常处理"><a href="#通用异常处理" class="headerlink" title="通用异常处理"></a>通用异常处理</h2><h3 id="1-场景预设"><a href="#1-场景预设" class="headerlink" title="1. 场景预设"></a>1. 场景预设</h3><p>新增商品类，接受以下两个参数：</p><blockquote><p>price 价格<br>  name 名称</p></blockquote><p>对数据进行校验：</p><ul><li>价格不能为空</li></ul><h2 id="2-代码实现"><a href="#2-代码实现" class="headerlink" title="2.代码实现"></a>2.代码实现</h2><h3 id="实体类："><a href="#实体类：" class="headerlink" title="实体类："></a>实体类：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Long price;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(Long price)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="service类"><a href="#service类" class="headerlink" title="service类:"></a>service类:</h3><p>该demo为测试所用，所以并未从数据库中获取数据而是采用本地的数据的方式。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemSevice</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Item <span class="title">saveTtem</span><span class="params">(Item item)</span></span>&#123;</span><br><span class="line">        <span class="comment">//商品新增</span></span><br><span class="line">        <span class="keyword">int</span> id = <span class="keyword">new</span> Random().nextInt(<span class="number">100</span>);</span><br><span class="line">        item.setId(id);</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="web类"><a href="#web类" class="headerlink" title="web类:"></a>web类:</h3><p>该demo主要是对通用异常如何使用的理解，通过注入ItemService获取所需依赖。在saveItem方法中，对价格进行了判断，如果为空则抛出异常，我们主要学习的是对抛出的异常进行处理。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"item"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ItemSevice itemSevice;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;Item&gt; <span class="title">saveItem</span><span class="params">(Item item)</span></span>&#123;</span><br><span class="line">        <span class="comment">//校验价格</span></span><br><span class="line">        <span class="keyword">if</span> (item.getPrice() == <span class="keyword">null</span>)&#123;</span><br><span class="line">           <span class="comment">// return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(null);</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> LyException(ExceptionEnum.PRICE_CANNOT_BE_NULL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.CREATED).body(item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="exception类："><a href="#exception类：" class="headerlink" title="exception类："></a>exception类：</h3><p>LyException调用了自定义的枚举类型ExceptionEnum。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*注解使用的是lombok的库，主要目的简化开发过程，省去写getter和setter方法以及构造函数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span><span class="comment">//无参构造函数</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span><span class="comment">//有参构造函数</span></span><br><span class="line"><span class="meta">@Getter</span><span class="comment">//获得getter方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LyException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ExceptionEnum exceptionEnum;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*    public ExceptionEnum getExceptionEnum() &#123;</span></span><br><span class="line"><span class="comment">        return exceptionEnum;</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="enums类："><a href="#enums类：" class="headerlink" title="enums类："></a>enums类：</h3><p>定义的枚举常量一般为大写。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> ExceptionEnum &#123;</span><br><span class="line">    PRICE_CANNOT_BE_NULL(<span class="number">400</span>, <span class="string">"价格不能为空"</span>),</span><br><span class="line">    <span class="comment">//PRICE_CANNOT_BE_NULL(400,"价格不能为空"),</span></span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="通用处理方法"><a href="#通用处理方法" class="headerlink" title="通用处理方法"></a>通用处理方法</h3><ul><li>@ControllerAdvice 注解，可以用于定义@ExceptionHandler、@InitBinder、@ModelAttribute，并应用到所有@RequestMapping中。</li><li>ResponseEntity继承了HttpEntity，是HttpEntity的子类且可以添加HttpStatus状态码（推测HttpEntity不能添加HttpStatus状态码）。被用于RestTemplate和Controller层方法</li><li>ResponseEntity是通用类型，因此可以使用任意类型作为响应体<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(LyException.class)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;ExceptionResult&gt; <span class="title">handleException</span><span class="params">(LyException e)</span></span>&#123;</span><br><span class="line">       <span class="comment">//ExceptionEnum em =e.getExceptionEnum();</span></span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(e.getExceptionEnum().getCode())</span><br><span class="line">                .body(<span class="keyword">new</span> ExceptionResult(e.getExceptionEnum()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>通用异常处理核心方法如上所示，返回ResponseEntity方法。.body(new ExceptionResult(e.getExceptionEnum()));获取异常结果。</p><h2 id="3-运行结果"><a href="#3-运行结果" class="headerlink" title="3.运行结果"></a>3.运行结果</h2><h3 id="成功"><a href="#成功" class="headerlink" title="成功"></a>成功</h3><p><img src="http://img.smallmartial.cn/QQ%E6%88%AA%E5%9B%BE20190412174841.png" alt></p><h3 id="失败"><a href="#失败" class="headerlink" title="失败"></a>失败</h3><p><img src="http://img.smallmartial.cn/QQ%E6%88%AA%E5%9B%BE20190412174854.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;通用异常处理&quot;&gt;&lt;a href=&quot;#通用异常处理&quot; class=&quot;headerlink&quot; title=&quot;通用异常处理&quot;&gt;&lt;/a&gt;通用异常处理&lt;/h2&gt;&lt;h3 id=&quot;1-场景预设&quot;&gt;&lt;a href=&quot;#1-场景预设&quot; class=&quot;headerlink&quot; titl
      
    
    </summary>
    
      <category term="乐优商城" scheme="https://github.com/smallmartial/blog.git/categories/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E/"/>
    
    
      <category term="java" scheme="https://github.com/smallmartial/blog.git/tags/java/"/>
    
      <category term="乐优商城" scheme="https://github.com/smallmartial/blog.git/tags/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E/"/>
    
      <category term="springboot" scheme="https://github.com/smallmartial/blog.git/tags/springboot/"/>
    
  </entry>
  
  <entry>
    <title>乐优商城学习笔记一-项目环境搭建</title>
    <link href="https://github.com/smallmartial/blog.git/2019/04/12/lyshop-1/"/>
    <id>https://github.com/smallmartial/blog.git/2019/04/12/lyshop-1/</id>
    <published>2019-04-12T05:09:58.000Z</published>
    <updated>2019-04-15T07:03:21.653Z</updated>
    
    <content type="html"><![CDATA[<h2 id="学习笔记一之项目环境搭建"><a href="#学习笔记一之项目环境搭建" class="headerlink" title="学习笔记一之项目环境搭建"></a>学习笔记一之项目环境搭建</h2><h2 id="项目介绍："><a href="#项目介绍：" class="headerlink" title="项目介绍："></a>项目介绍：</h2><blockquote><p>本项目属于只用作学习，不做任何商业性活动。乐优商城是一个全品类的电商购物网站（B2C）。</p></blockquote><h2 id="学习所涉及到技术点"><a href="#学习所涉及到技术点" class="headerlink" title="学习所涉及到技术点"></a>学习所涉及到技术点</h2><h3 id="前端技术："><a href="#前端技术：" class="headerlink" title="前端技术："></a>前端技术：</h3><ul><li>基础的HTML、CSS、JavaScript（基于ES6标准）</li><li>JQuery</li><li>Vue.js 2.0以及基于Vue的框架：Vuetify</li><li>前端构建工具：WebPack</li><li>前端安装包工具：NPM</li><li>Vue脚手架：Vue-cli</li><li>Vue路由：vue-router</li><li>ajax框架：axios</li><li>基于Vue的富文本框架：quill-editor</li></ul><h3 id="后端技术："><a href="#后端技术：" class="headerlink" title="后端技术："></a>后端技术：</h3><ul><li>基础的SpringMVC、Spring 5.0和MyBatis3</li><li>Spring Boot 2.0.1版本</li><li>Spring Cloud 最新版 Finchley.RC1</li><li>Redis-4.0</li><li>RabbitMQ-3.4</li><li>Elasticsearch-5.6.8</li><li>nginx-1.10.2：</li><li>FastDFS - 5.0.8</li><li>MyCat</li><li>Thymeleaf  </li></ul><h2 id="1-创建父工程"><a href="#1-创建父工程" class="headerlink" title="1.创建父工程"></a>1.创建父工程</h2><p>创建统一的父工程：smallmartial，用来管理依赖及其版本，注意是创建project，而不是moudle.<br><img src="http://img.smallmartial.cn/20190412132810.png" alt><br>填写项目信息：<br><img src="http://img.smallmartial.cn/20190412132811.png" alt><br>修改pom:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>ly-registry<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>ly-gateway<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>ly-item<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>ly-common<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.smallmartial.parent<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>leyou<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>leyou<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-cloud.version</span>&gt;</span>Greenwich.M1<span class="tag">&lt;/<span class="name">spring-cloud.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mybatis.starter.version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">mybatis.starter.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper.starter.version</span>&gt;</span>2.0.2<span class="tag">&lt;/<span class="name">mapper.starter.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">druid.starter.version</span>&gt;</span>1.1.9<span class="tag">&lt;/<span class="name">druid.starter.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.32<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pageHelper.starter.version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">pageHelper.starter.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">leyou.latest.version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">leyou.latest.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">fastDFS.client.version</span>&gt;</span>1.26.1-RELEASE<span class="tag">&lt;/<span class="name">fastDFS.client.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- springCloud --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- mybatis启动器 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.starter.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 通用Mapper启动器 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>tk.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mapper.starter.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 分页助手启动器 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;pageHelper.starter.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- mysql驱动 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--FastDFS客户端--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">                &lt;groupId&gt;com.github.tobato&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">                &lt;artifactId&gt;fastdfs-client&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">                &lt;version&gt;$&#123;fastDFS.client.version&#125;&lt;/version&gt;</span></span><br><span class="line"><span class="comment">            &lt;/dependency&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>spring-milestones<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Spring Milestones<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://repo.spring.io/milestone<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h2 id="2-创建EurkaServer"><a href="#2-创建EurkaServer" class="headerlink" title="2.创建EurkaServer"></a>2.创建EurkaServer</h2><h3 id="2-1创建工程"><a href="#2-1创建工程" class="headerlink" title="2.1创建工程"></a>2.1创建工程</h3><p>选择父项目，然后添加module模块。<br><img src="http://img.smallmartial.cn/20190412133942.png" alt><br>选择安装目录，因为是聚合项目，目录应该是在父工程leyou的下面：<br><img src="http://img.smallmartial.cn/20190412134003.png" alt></p><h3 id="2-2添加EurekaServer依赖"><a href="#2-2添加EurekaServer依赖" class="headerlink" title="2.2添加EurekaServer依赖"></a>2.2添加EurekaServer依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>leyou<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.smallmartial.parent<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.smallmartial.common<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ly-registry<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-3-编写启动类"><a href="#2-3-编写启动类" class="headerlink" title="2.3 编写启动类"></a>2.3 编写启动类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LyRegistry</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(LyRegistry.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-4配置文件"><a href="#2-4配置文件" class="headerlink" title="2.4配置文件"></a>2.4配置文件</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">10086</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">ly-registry</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    fetch-registry:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://127.0.0.1:$&#123;server.port&#125;/eureka</span></span><br><span class="line"><span class="attr">  server:</span></span><br><span class="line"><span class="attr">    enable-self-preservation:</span> <span class="literal">false</span> <span class="comment"># 关闭自我保护</span></span><br><span class="line"><span class="attr">    eviction-interval-timer-in-ms:</span> <span class="number">5000</span> <span class="comment"># 每隔5秒进行一次服务列表清理</span></span><br></pre></td></tr></table></figure><h2 id="3-创建Zuul网关"><a href="#3-创建Zuul网关" class="headerlink" title="3.创建Zuul网关"></a>3.创建Zuul网关</h2><p>与上面类似。</p><h3 id="3-1添加依赖"><a href="#3-1添加依赖" class="headerlink" title="3.1添加依赖"></a>3.1添加依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>leyou<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.smallmartial.parent<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.smallmartial.common<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ly-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-zuul<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--是springboot提供的微服务检测接口，默认对外提供几个接口：/info--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-2编写启动类"><a href="#3-2编写启动类" class="headerlink" title="3.2编写启动类"></a>3.2编写启动类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableZuulProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LyApiGateway</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(LyApiGateway.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3编写配置文件"><a href="#3-3编写配置文件" class="headerlink" title="3.3编写配置文件"></a>3.3编写配置文件</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">10010</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">api-gateway</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://127.0.0.1:10086/eureka</span></span><br><span class="line"><span class="attr">    registry-fetch-interval-seconds:</span> <span class="number">5</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line"><span class="attr">    prefer-ip-address:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    ip-address:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"><span class="attr">    instance-id:</span> <span class="string">$&#123;spring.application.name&#125;:$&#123;server.port&#125;</span></span><br><span class="line"><span class="attr">zuul:</span></span><br><span class="line"><span class="attr">  prefix:</span> <span class="string">/api</span> <span class="comment"># 添加路由前缀</span></span><br><span class="line"><span class="attr">  retryable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">ribbon:</span></span><br><span class="line"><span class="attr">  ConnectTimeout:</span> <span class="number">250</span> <span class="comment"># 连接超时时间(ms)</span></span><br><span class="line"><span class="attr">  ReadTimeout:</span> <span class="number">2000</span> <span class="comment"># 通信超时时间(ms)</span></span><br><span class="line"><span class="attr">  OkToRetryOnAllOperations:</span> <span class="literal">true</span> <span class="comment"># 是否对所有操作重试</span></span><br><span class="line"><span class="attr">  MaxAutoRetriesNextServer:</span> <span class="number">1</span> <span class="comment"># 同一服务不同实例的重试次数</span></span><br><span class="line"><span class="attr">  MaxAutoRetries:</span> <span class="number">1</span> <span class="comment"># 同一实例的重试次数</span></span><br><span class="line"><span class="attr">hystrix:</span></span><br><span class="line"><span class="attr">  command:</span></span><br><span class="line"><span class="attr">    default:</span></span><br><span class="line"><span class="attr">      execution:</span></span><br><span class="line"><span class="attr">        isolation:</span></span><br><span class="line"><span class="attr">          thread:</span></span><br><span class="line"><span class="attr">            timeoutInMillisecond:</span> <span class="number">10000</span> <span class="comment"># 熔断超时时长：10000ms</span></span><br></pre></td></tr></table></figure><h3 id="3-4项目结构"><a href="#3-4项目结构" class="headerlink" title="3.4项目结构"></a>3.4项目结构</h3><p><img src="http://img.smallmartial.cn/20190412135050.png" alt></p><h2 id="4-创建商品微服务结构"><a href="#4-创建商品微服务结构" class="headerlink" title="4.创建商品微服务结构"></a>4.创建商品微服务结构</h2><p>商品微服务。其中会包含对于商品相关的一系列内容的管理，包括：</p><ul><li>商品分类管理</li><li>品牌管理</li><li>商品规格参数管理</li><li>商品管理</li><li>库存管理</li></ul><p>我们先完成项目的搭建：</p><p>因为与商品的品类相关，我们的工程命名为<code>ly-item</code>.<br>我们会在ly-item中创建两个子工程：</p><ul><li>ly-item-interface：主要是对外暴露的接口及相关实体类</li><li>ly-item-service：所有业务逻辑及内部使用接口</li></ul><h3 id="4-1-创建父工程ly-item"><a href="#4-1-创建父工程ly-item" class="headerlink" title="4.1 创建父工程ly_item"></a>4.1 创建父工程ly_item</h3><p>使用meavn进行构建<br><img src="http://img.smallmartial.cn/QQ%E6%88%AA%E5%9B%BE20190412140057.png" alt><br>保存位置<br><img src="http://img.smallmartial.cn/QQ%E6%88%AA%E5%9B%BE20190412140113.png" alt><br>不需要任何依赖，我们可以把项目打包方式设置为pom<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>leyou<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.smallmartial.parent<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.smallmartial.service<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ly-item<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>ly-item-interface<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>ly-item-service<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h3 id="4-2创建子模块"><a href="#4-2创建子模块" class="headerlink" title="4.2创建子模块"></a>4.2创建子模块</h3><ul><li>在ly-item工程上点击右键，选择new &gt; module:</li></ul><ul><li><p>依然是使用maven构建，注意父工程是ly-item：</p></li><li><p><strong>注意</strong>：接下来填写的目录结构需要自己手动完成，保存到<code>ly-item</code>下的<code>ly-item-interface</code>目录中：</p></li></ul><ul><li>点击Finish完成。<h3 id="4-3工程目录如下："><a href="#4-3工程目录如下：" class="headerlink" title="4.3工程目录如下："></a>4.3工程目录如下：</h3><img src="http://img.smallmartial.cn/QQ%E6%88%AA%E5%9B%BE20190412140738.png" alt></li></ul><h3 id="4-3添加依赖"><a href="#4-3添加依赖" class="headerlink" title="4.3添加依赖"></a>4.3添加依赖</h3><p>ly-item-service`中添加依赖：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--Eureka客户端--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--web启动器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mybatis启动器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.starter.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 通用Mapper启动器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>tk.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mapper.starter.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 分页助手启动器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;pageHelper.starter.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mysql驱动 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.smallmartial.service<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ly-item-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.smallmartial.common<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ly-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h3 id="4-5编写启动和配置"><a href="#4-5编写启动和配置" class="headerlink" title="4.5编写启动和配置"></a>4.5编写启动和配置</h3><p>在整个<code>ly-item工程</code>中，只有<code>ly-item-service</code>是需要启动的。因此在其中编写启动类即可：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LyItemService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(LyItemService.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后是全局属性文件：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">item-service</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://localhost:3306/heima</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="number">123</span></span><br><span class="line"><span class="attr">    hikari:</span></span><br><span class="line"><span class="attr">      maximum-pool-size:</span> <span class="number">30</span></span><br><span class="line"><span class="attr">      minimum-idle:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://127.0.0.1:10086/eureka</span></span><br><span class="line"><span class="attr">  instance:</span></span><br><span class="line"><span class="attr">    lease-renewal-interval-in-seconds:</span> <span class="number">5</span> <span class="comment"># 每隔5秒发送一次心跳</span></span><br><span class="line"><span class="attr">    lease-expiration-duration-in-seconds:</span> <span class="number">10</span> <span class="comment"># 10秒不发送就过期</span></span><br><span class="line"><span class="attr">    prefer-ip-address:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    ip-address:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"><span class="attr">    instance-id:</span> <span class="string">$&#123;spring.application.name&#125;:$&#123;server.port&#125;</span></span><br></pre></td></tr></table></figure><h2 id="4-6添加商品微服务的路由规则"><a href="#4-6添加商品微服务的路由规则" class="headerlink" title="4.6添加商品微服务的路由规则"></a>4.6添加商品微服务的路由规则</h2><p>既然商品微服务已经创建，接下来肯定要添加路由规则到Zuul中，我们不使用默认的路由规则。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">zuul:</span></span><br><span class="line"><span class="attr">  prefix:</span> <span class="string">/api</span> <span class="comment"># 添加路由前缀</span></span><br><span class="line"><span class="attr">  retryable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  routes:</span></span><br><span class="line"><span class="attr">    item-service:</span> <span class="string">/item/**</span> <span class="comment"># 将商品微服务映射到/item/**</span></span><br></pre></td></tr></table></figure><h2 id="5-启动测试"><a href="#5-启动测试" class="headerlink" title="5.启动测试"></a>5.启动测试</h2><p><img src="http://img.smallmartial.cn/QQ%E6%88%AA%E5%9B%BE20190412162548.png" alt></p><p>###Eureka 注册中心<br><img src="http://img.smallmartial.cn/QQ%E6%88%AA%E5%9B%BE20190412162530.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;学习笔记一之项目环境搭建&quot;&gt;&lt;a href=&quot;#学习笔记一之项目环境搭建&quot; class=&quot;headerlink&quot; title=&quot;学习笔记一之项目环境搭建&quot;&gt;&lt;/a&gt;学习笔记一之项目环境搭建&lt;/h2&gt;&lt;h2 id=&quot;项目介绍：&quot;&gt;&lt;a href=&quot;#项目介绍：&quot; c
      
    
    </summary>
    
      <category term="乐优商城" scheme="https://github.com/smallmartial/blog.git/categories/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E/"/>
    
    
      <category term="java" scheme="https://github.com/smallmartial/blog.git/tags/java/"/>
    
      <category term="乐优商城" scheme="https://github.com/smallmartial/blog.git/tags/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E/"/>
    
      <category term="springboot" scheme="https://github.com/smallmartial/blog.git/tags/springboot/"/>
    
  </entry>
  
  <entry>
    <title>vue学习二</title>
    <link href="https://github.com/smallmartial/blog.git/2019/04/12/vue%E4%BA%8C/"/>
    <id>https://github.com/smallmartial/blog.git/2019/04/12/vue二/</id>
    <published>2019-04-12T05:07:32.000Z</published>
    <updated>2019-04-12T08:28:58.996Z</updated>
    
    <content type="html"><![CDATA[<h3 id="自定义指令"><a href="#自定义指令" class="headerlink" title="自定义指令"></a>自定义指令</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//全局注册</span></span><br><span class="line">        Vue.directive(<span class="string">'focus'</span>,&#123;</span><br><span class="line">        &#125;)</span><br><span class="line"><span class="comment">//局部注册</span></span><br><span class="line">        <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">            el:<span class="string">"#pp"</span></span><br><span class="line">            directives:&#123;</span><br><span class="line">              forcus:&#123;</span><br><span class="line">              </span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure><p>写法与组建写法类似，方法名有component改变为directive。<br>自定义指令是有几个钩子函数组成的，每个都是可选项。</p><ul><li>bind</li><li>inserted</li><li>update</li><li>componentUpdated</li><li>unbind<br>每个钩子函数都有几个参数可用。<ul><li>el 指令绑定的元素，可以直接用来操作DOM</li></ul></li><li>binding 一个对象，包含以下属性。<ul><li>name</li><li>value</li><li>oldValue</li><li>expression</li><li>arg</li><li>modifiers</li></ul></li><li>vnode Vue编译生成虚拟节点</li><li>oldVnode 上一个虚拟节点仅在update 和componentUpdated钩子中可用。</li></ul><h2 id="Render函数"><a href="#Render函数" class="headerlink" title="Render函数"></a>Render函数</h2><blockquote><p>Vue 推荐在绝大多数情况下使用 template 来创建你的 HTML。然而在一些场景中，你真的需要 JavaScript 的完全编程的能力，这时你可以用 render 函数，它比 template 更接近编译器。</p></blockquote><h3 id="createElement用法"><a href="#createElement用法" class="headerlink" title="createElement用法"></a>createElement用法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @returns &#123;VNode&#125;</span></span><br><span class="line">createElement(</span><br><span class="line">  <span class="comment">// &#123;String | Object | Function&#125;</span></span><br><span class="line">  <span class="comment">// 一个 HTML 标签字符串，组件选项对象，或者</span></span><br><span class="line">  <span class="comment">// 解析上述任何一种的一个 async 异步函数。必需参数。</span></span><br><span class="line">  <span class="string">'div'</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// &#123;Object&#125;</span></span><br><span class="line">  <span class="comment">// 一个包含模板相关属性的数据对象</span></span><br><span class="line">  <span class="comment">// 你可以在 template 中使用这些特性。可选参数。</span></span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// &#123;String | Array&#125;</span></span><br><span class="line">  <span class="comment">// 子虚拟节点 (VNodes)，由 `createElement()` 构建而成，</span></span><br><span class="line">  <span class="comment">// 也可以使用字符串来生成“文本虚拟节点”。可选参数。</span></span><br><span class="line">  [</span><br><span class="line">    <span class="string">'先写一些文字'</span>,</span><br><span class="line">    createElement(<span class="string">'h1'</span>, <span class="string">'一则头条'</span>),</span><br><span class="line">    createElement(MyComponent, &#123;</span><br><span class="line">      props: &#123;</span><br><span class="line">        someProp: <span class="string">'foobar'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>第一个参数必选，可以是一个htm标签,也可以是一个组件或者函数，第二个是可选参数对象数据，在template中使用。第三个是子节点，也是可选参数。</p><h3 id="对于第二个数据对象，具有选项如下："><a href="#对于第二个数据对象，具有选项如下：" class="headerlink" title="对于第二个数据对象，具有选项如下："></a>对于第二个数据对象，具有选项如下：</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 和`v-bind:class`一样的 API</span></span><br><span class="line">  <span class="comment">// 接收一个字符串、对象或字符串和对象组成的数组</span></span><br><span class="line">  <span class="string">'class'</span>: &#123;</span><br><span class="line">    foo: <span class="literal">true</span>,</span><br><span class="line">    bar: <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 和`v-bind:style`一样的 API</span></span><br><span class="line">  <span class="comment">// 接收一个字符串、对象或对象组成的数组</span></span><br><span class="line">  style: &#123;</span><br><span class="line">    color: <span class="string">'red'</span>,</span><br><span class="line">    fontSize: <span class="string">'14px'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 普通的 HTML 特性</span></span><br><span class="line">  attrs: &#123;</span><br><span class="line">    id: <span class="string">'foo'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 组件 props</span></span><br><span class="line">  props: &#123;</span><br><span class="line">    myProp: <span class="string">'bar'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// DOM 属性</span></span><br><span class="line">  domProps: &#123;</span><br><span class="line">    innerHTML: <span class="string">'baz'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 事件监听器基于 `on`</span></span><br><span class="line">  <span class="comment">// 所以不再支持如 `v-on:keyup.enter` 修饰器</span></span><br><span class="line">  <span class="comment">// 需要手动匹配 keyCode。</span></span><br><span class="line">  on: &#123;</span><br><span class="line">    click: <span class="keyword">this</span>.clickHandler</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 仅用于组件，用于监听原生事件，而不是组件内部使用</span></span><br><span class="line">  <span class="comment">// `vm.$emit` 触发的事件。</span></span><br><span class="line">  nativeOn: &#123;</span><br><span class="line">    click: <span class="keyword">this</span>.nativeClickHandler</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 自定义指令。注意，你无法对 `binding` 中的 `oldValue`</span></span><br><span class="line">  <span class="comment">// 赋值，因为 Vue 已经自动为你进行了同步。</span></span><br><span class="line">  directives: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">'my-custom-directive'</span>,</span><br><span class="line">      value: <span class="string">'2'</span>,</span><br><span class="line">      expression: <span class="string">'1 + 1'</span>,</span><br><span class="line">      arg: <span class="string">'foo'</span>,</span><br><span class="line">      modifiers: &#123;</span><br><span class="line">        bar: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 作用域插槽格式</span></span><br><span class="line">  <span class="comment">// &#123; name: props =&gt; VNode | Array&lt;VNode&gt; &#125;</span></span><br><span class="line">  scopedSlots: &#123;</span><br><span class="line">    <span class="keyword">default</span>: <span class="function"><span class="params">props</span> =&gt;</span> createElement(<span class="string">'span'</span>, props.text)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 如果组件是其他组件的子组件，需为插槽指定名称</span></span><br><span class="line">  slot: <span class="string">'name-of-slot'</span>,</span><br><span class="line">  <span class="comment">// 其他特殊顶层属性</span></span><br><span class="line">  key: <span class="string">'myKey'</span>,</span><br><span class="line">  ref: <span class="string">'myRef'</span>,</span><br><span class="line">  <span class="comment">// 如果你在渲染函数中向多个元素都应用了相同的 ref 名，</span></span><br><span class="line">  <span class="comment">// 那么 `$refs.myRef` 会变成一个数组。</span></span><br><span class="line">  refInFor: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="template与Render对比："><a href="#template与Render对比：" class="headerlink" title="template与Render对比："></a>template与Render对比：</h3><h4 id="template用法："><a href="#template用法：" class="headerlink" title="template用法："></a>template用法：</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">'app'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ele</span>&gt;</span><span class="tag">&lt;/<span class="name">ele</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    Vue.component(<span class="string">'ele'</span>,&#123;</span></span><br><span class="line"><span class="xml">        template: ` <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"element"</span> <span class="attr">:class</span>=<span class="string">"&#123;show:show&#125;"</span> @<span class="attr">click</span>=<span class="string">"handleClick"</span>&gt;</span>文本内容<span class="tag">&lt;/<span class="name">div</span>&gt;</span>`,</span></span><br><span class="line"><span class="javascript">        data: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span>&#123;</span></span><br><span class="line"><span class="javascript">                show:<span class="literal">true</span></span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        methods: &#123;</span></span><br><span class="line"><span class="javascript">            handleClick:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'clicked!'</span>);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">'#app'</span></span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Render用法："><a href="#Render用法：" class="headerlink" title="Render用法："></a>Render用法：</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">'app'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ele</span>&gt;</span><span class="tag">&lt;/<span class="name">ele</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    Vue.component(<span class="string">'ele'</span>,&#123;</span></span><br><span class="line"><span class="javascript">        render:<span class="function"><span class="keyword">function</span>(<span class="params">createElement</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> createElement(</span></span><br><span class="line"><span class="javascript">                <span class="string">'div'</span>,&#123;</span></span><br><span class="line"><span class="undefined">                    class:&#123;'show':this.show&#125;,</span></span><br><span class="line"><span class="javascript">                    attrs:&#123;<span class="attr">id</span>:<span class="string">'element'</span>&#125;,</span></span><br><span class="line"><span class="javascript">                    on:&#123;<span class="attr">click</span>:<span class="keyword">this</span>.handleClick&#125;</span></span><br><span class="line"><span class="undefined">                &#125;,</span></span><br><span class="line"><span class="javascript">                <span class="string">'文本内容'</span></span></span><br><span class="line"><span class="undefined">            )</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="javascript">        data: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span>&#123;</span></span><br><span class="line"><span class="javascript">                show:<span class="literal">true</span></span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        methods: &#123;</span></span><br><span class="line"><span class="javascript">            handleClick:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'clicked!'</span>);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">'#app'</span></span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">SCript</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h3><p><img src="https://upload-images.jianshu.io/upload_images/7149586-6f73e2c6e5bab72c.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="运行结果"></p><blockquote><p>针对此例，template的写法比Render写法简洁，所以要在合适的场景使用Render函数，否则只会增加负担。</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;自定义指令&quot;&gt;&lt;a href=&quot;#自定义指令&quot; class=&quot;headerlink&quot; title=&quot;自定义指令&quot;&gt;&lt;/a&gt;自定义指令&lt;/h3&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;p
      
    
    </summary>
    
      <category term="vue" scheme="https://github.com/smallmartial/blog.git/categories/vue/"/>
    
    
      <category term="vue" scheme="https://github.com/smallmartial/blog.git/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>设计模式-装饰者模式</title>
    <link href="https://github.com/smallmartial/blog.git/2019/04/11/java-1/"/>
    <id>https://github.com/smallmartial/blog.git/2019/04/11/java-1/</id>
    <published>2019-04-11T06:28:35.000Z</published>
    <updated>2019-04-12T05:21:28.737Z</updated>
    
    <content type="html"><![CDATA[<h2 id="装饰者模式概念："><a href="#装饰者模式概念：" class="headerlink" title="装饰者模式概念："></a>装饰者模式概念：</h2><p>装饰者模式又名包装(Wrapper)模式。装饰者模式以对客户端透明的方式扩展对象的功能，是继承关系的一个替代方案。</p><p>装饰者模式动态地将责任附加到对象身上。若要扩展功能，装饰者提供了比继承更有弹性的替代方案。</p><h2 id="装饰模式的结构"><a href="#装饰模式的结构" class="headerlink" title="装饰模式的结构"></a>装饰模式的结构</h2><blockquote><p>装饰者模式以对客户透明的方式动态地给一个对象附加上更多的责任。换言之，客户端并不会觉得对象在装饰前和装饰后有什么不同。装饰者模式可以在不使用创造更多子类的情况下，将对象的功能加以扩展。</p></blockquote><p>装饰者模式UML类图:<br><img src="https://upload-images.jianshu.io/upload_images/7149586-b5a2966000ab6822.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="装饰者模式类图"></p><h3 id="装饰者模式中的角色有："><a href="#装饰者模式中的角色有：" class="headerlink" title="装饰者模式中的角色有："></a>装饰者模式中的角色有：</h3><ul><li>抽象构件(Component)角色：给出一个抽象接口，以规范准备接收附加责任的对象。<ul><li>具体构件(ConcreteComponent)角色：定义一个将要接收附加责任的类。</li><li>装饰(Decorator)角色：持有一个构件(Component)对象的实例，并定义一个与抽象构件接口一致的接口。</li><li>具体装饰(ConcreteDecorator)角色：负责给构件对象“贴上”附加的责任。<h2 id="装饰模式实例演示："><a href="#装饰模式实例演示：" class="headerlink" title="装饰模式实例演示："></a>装饰模式实例演示：</h2>儿子、妈妈、父亲三人合作画一幅画，儿子负责画出一朵花的轮廓，妈妈负责涂上颜色、父亲负责将画裱在画框里。请编写程序模拟这个过程。UML类图如下：<br><img src="https://upload-images.jianshu.io/upload_images/7149586-d32bc95b38f02154.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="UML"><br>代码实现：<br>接口类：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Painter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><p>具体构建son类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Son</span> <span class="keyword">implements</span> <span class="title">Painter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"我是儿子，我花了花的轮廓"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>抽象角色Decorater类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Decorator</span> <span class="keyword">implements</span> <span class="title">Painter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Painter painter;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Decorator</span><span class="params">(Painter painter)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.painter = painter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">painter.draw();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>具体装饰角色mother:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mother</span> <span class="keyword">extends</span> <span class="title">Decorator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Mother</span><span class="params">(Painter painter)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>(painter);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>.draw();</span><br><span class="line">System.out.println(<span class="string">"Mother Draw"</span>);</span><br><span class="line"><span class="keyword">this</span>.color();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">color</span><span class="params">()</span></span>&#123;</span><br><span class="line">System.out.println(<span class="string">"我是妈妈，我给画涂色"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>具体装饰角色father：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Father</span> <span class="keyword">extends</span> <span class="title">Decorator</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Father</span><span class="params">(Painter painter)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>(painter);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>.draw();</span><br><span class="line">System.out.println(<span class="string">"Father Draw"</span>);</span><br><span class="line"><span class="keyword">this</span>.mounting();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mounting</span><span class="params">()</span></span>&#123;</span><br><span class="line">System.out.println(<span class="string">"我是爸爸，我将画裱起来"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>实现类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Painter son = <span class="keyword">new</span> Son();</span><br><span class="line">son.draw();</span><br><span class="line">Decorator son1=<span class="keyword">new</span> Mother(son); </span><br><span class="line">son1.draw();</span><br><span class="line">Decorator son2=<span class="keyword">new</span> Father(son); </span><br><span class="line">son2.draw();</span><br><span class="line"></span><br><span class="line"><span class="comment">//System.out.println();</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>运行结果：<br><img src="https://upload-images.jianshu.io/upload_images/7149586-4098fbbbe713c18f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result.png"></p><h2 id="装饰者模式的优缺点"><a href="#装饰者模式的优缺点" class="headerlink" title="装饰者模式的优缺点"></a>装饰者模式的优缺点</h2><h3 id="装饰者模式的优点："><a href="#装饰者模式的优点：" class="headerlink" title="装饰者模式的优点："></a>装饰者模式的优点：</h3><ul><li>装饰模式与继承关系的目的都是要扩展对象的功能，但是装饰模式可以提供比继承更多的灵活性。装饰模式允许系统动态决定“贴上”一个需要的“装饰”，或者除掉一个不需要的“装饰”。继承关系则不同，继承关系是静态的，它在系统运行前就决定了。</li><li>通过使用不同的具体装饰类以及这些装饰类的排列组合，设计师可以创造出很多不同行为的组合。<h3 id="装饰者模式的缺点："><a href="#装饰者模式的缺点：" class="headerlink" title="装饰者模式的缺点："></a>装饰者模式的缺点：</h3></li><li>由于使用装饰模式，可以比使用继承关系需要较少数目的类。使用较少的类，当然使设计比较易于进行。但是，在另一方面，使用装饰模式会产生比使用继承关系更多的对象。更多的对象会使得查错变得困难，特别是这些对象看上去都很相像。</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;装饰者模式概念：&quot;&gt;&lt;a href=&quot;#装饰者模式概念：&quot; class=&quot;headerlink&quot; title=&quot;装饰者模式概念：&quot;&gt;&lt;/a&gt;装饰者模式概念：&lt;/h2&gt;&lt;p&gt;装饰者模式又名包装(Wrapper)模式。装饰者模式以对客户端透明的方式扩展对象的功能，是继
      
    
    </summary>
    
      <category term="java" scheme="https://github.com/smallmartial/blog.git/categories/java/"/>
    
    
      <category term="java" scheme="https://github.com/smallmartial/blog.git/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>Vue学习一</title>
    <link href="https://github.com/smallmartial/blog.git/2019/04/09/vue_1/"/>
    <id>https://github.com/smallmartial/blog.git/2019/04/09/vue_1/</id>
    <published>2019-04-09T13:44:42.000Z</published>
    <updated>2019-04-11T06:11:52.100Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Vue组件的使用"><a href="#Vue组件的使用" class="headerlink" title="Vue组件的使用"></a>Vue组件的使用</h2><p>组件是vue.js中最核心的功能，是整个框架设计最精彩的地方，也是最理解的。</p><p>###组件的用法<br>组件与创建vue类似，需要组测之后才能使用。</p><p>####全局注册<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Vue.component(<span class="string">'my-component'</span>,&#123;</span><br><span class="line">    template:<span class="string">"&lt;h1&gt;这是全局组件&lt;/h1&gt;"</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>渲染后结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;h1&gt;这是全局组件&lt;/h1&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p><p>####父子之间通信<br>在组件中使用props声明需要从父级接受的数据，props的值可以是两种：字符串或者对象。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">introduce</span> <span class="attr">:titles</span>=<span class="string">"msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">introduce</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">for-component</span> <span class="attr">:items</span>=<span class="string">"lessons"</span>&gt;</span><span class="tag">&lt;/<span class="name">for-component</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">my-component</span>&gt;</span><span class="tag">&lt;/<span class="name">my-component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="comment">//父向子通信</span></span><br><span class="line">    <span class="keyword">const</span> introduce = &#123;</span><br><span class="line">        template:<span class="string">"&lt;h1&gt;&#123;&#123;titles&#125;&#125;&lt;/h1&gt;"</span>,</span><br><span class="line">        props:[<span class="string">'titles'</span>]</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> forComponent =&#123;</span><br><span class="line">            template:<span class="string">"&lt;ul&gt;&lt;li v-for='item in items'&gt;&#123;&#123;item&#125;&#125;&lt;/li&gt;&lt;/ul&gt;"</span> ,</span><br><span class="line">       <span class="comment">// props:['items']</span></span><br><span class="line">        props: &#123;<span class="attr">items</span>:&#123;</span><br><span class="line">                type:<span class="built_in">Array</span>,</span><br><span class="line">                <span class="keyword">default</span>:[<span class="string">'java'</span>]</span><br><span class="line">            &#125;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">        el:<span class="string">"#app"</span>,</span><br><span class="line">        data:&#123;</span><br><span class="line">            msg:<span class="string">"大家好"</span>,</span><br><span class="line">            lessons:[<span class="string">"java"</span>,<span class="string">'php'</span>,<span class="string">'python'</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        components:&#123;</span><br><span class="line">            introduce,forComponent</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>渲染后的结果<br><img src="http://img.smallmartial.cn/vue_1.png" alt="父子通信结果"></p><p>####子向父之间通信<br>子组件用$emit()来触发事件，示例代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">    &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">        &lt;counter :num=&quot;count&quot; @incr=&quot;add&quot; @decr=&quot;reduce&quot;&gt;&lt;/counter&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    const counter = &#123;</span><br><span class="line">        template:`</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">         &lt;button @click=&quot;handleAdd&quot;&gt;+&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;handleReduce&quot;&gt;-&lt;/button&gt;</span><br><span class="line">        &lt;h1&gt;Num:&#123;&#123;num&#125;&#125;&lt;/h1&gt;</span><br><span class="line">        &lt;/div&gt;`,</span><br><span class="line">        props:[&apos;num&apos;],</span><br><span class="line">        methods: &#123;</span><br><span class="line">            handleAdd()&#123;</span><br><span class="line">                this.$emit(&apos;incr&apos;);</span><br><span class="line">            &#125;,</span><br><span class="line">            handleReduce()&#123;</span><br><span class="line">                this.$emit(&apos;decr&apos;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    const app = new Vue(&#123;</span><br><span class="line">        el:&quot;#app&quot;,</span><br><span class="line">        data:&#123;</span><br><span class="line">            count:0,</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        components:&#123;</span><br><span class="line">            counter</span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;</span><br><span class="line">            add()&#123;</span><br><span class="line">                this.count++;</span><br><span class="line">            &#125;,</span><br><span class="line">            reduce()&#123;</span><br><span class="line">                this.count--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p><p>const 是ec6中的语法，子向父通信较为麻烦。<br>渲染后的结果：<br><img src="http://img.smallmartial.cn/vue_2.png" alt="父子通信结果"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Vue组件的使用&quot;&gt;&lt;a href=&quot;#Vue组件的使用&quot; class=&quot;headerlink&quot; title=&quot;Vue组件的使用&quot;&gt;&lt;/a&gt;Vue组件的使用&lt;/h2&gt;&lt;p&gt;组件是vue.js中最核心的功能，是整个框架设计最精彩的地方，也是最理解的。&lt;/p&gt;
&lt;p&gt;
      
    
    </summary>
    
      <category term="vue" scheme="https://github.com/smallmartial/blog.git/categories/vue/"/>
    
    
      <category term="vue" scheme="https://github.com/smallmartial/blog.git/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>springboot一</title>
    <link href="https://github.com/smallmartial/blog.git/2019/04/07/springboot%E4%B8%80/"/>
    <id>https://github.com/smallmartial/blog.git/2019/04/07/springboot一/</id>
    <published>2019-04-07T11:16:20.000Z</published>
    <updated>2019-04-11T06:09:46.026Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Springboot整合Mybatis"><a href="#Springboot整合Mybatis" class="headerlink" title="Springboot整合Mybatis"></a>Springboot整合Mybatis</h2><p>SpringBoot官方并没有提供Mybatis的启动器，不过Mybatis<a href="https://github.com/mybatis/spring-boot-starter">官网</a>自己实现了：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mybatis:</span><br><span class="line"> # configuration:</span><br><span class="line">    #map-underscore-to-camel-case: true</span><br><span class="line">  #mapper-locations: mapper/*.xml</span><br><span class="line">type-aliases-package: cn.smallmartial.springbootdemo.pojo</span><br><span class="line"># mapper.xml文件位置,如果没有映射文件，请注释掉</span><br><span class="line">mybatis.mapper-locations=classpath:mappers/*.xml</span><br></pre></td></tr></table></figure><p>关于配置文件中华mybaits的configuration中 如果没有内容，需要注释掉否则会报错，笔者太菜，查阅很长时间才找到错误所在。</p><h3 id="通用mapper配置"><a href="#通用mapper配置" class="headerlink" title="通用mapper配置"></a>通用mapper配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;tk.mybatis&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mapper-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.0.2&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>通用Mapper都可以极大的方便开发人员。可以随意的按照自己的需要选择通用方法，还可以很方便的开发自己的通用方法。<br>极其方便的使用MyBatis单表的增删改查。支持单表操作，<br>不支持通用的多表联合查询。</p><h3 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h3><p>继承通用的Mapper<t>，必须指定泛型<t>,导包需要导入tk.mybaits中的包。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tk.mybatis.mapper.common.Mapper;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></t></t></p><p>通用mapper中含有单表的增删改查<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据T对象中的属性名称查询,类似于select * from table where t.username=xxx and t.mobile = xxxx</span></span><br><span class="line"></span><br><span class="line"><span class="function">List&lt;T&gt; <span class="title">select</span><span class="params">(T t)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//如果断定T对象的查询条件是一个,可以调用此方法,返回单个对象</span></span></span><br><span class="line"><span class="function">T <span class="title">selectOne</span><span class="params">(T t)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//根据主键查询</span></span></span><br><span class="line"><span class="function">T <span class="title">selectByPrimaryKey</span><span class="params">(Object id)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//根据主键更新数据,T对象里面有什么属性就更新什么属性,如果T对象没有主键,抛出异常</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">updateByPrimaryKeySelective</span><span class="params">(T t)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//根据主键更新数据,需要把对象中所有的字段全部填充才能调用此方法,一般不常用!</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">updateByPrimaryKey</span><span class="params">(T t)</span></span></span><br><span class="line"><span class="function"><span class="comment">//根据主键更新数据,T对象里面有什么属性就更新什么属性,如果T对象没有主键,抛出异常</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">updateByPrimaryKeySelective</span><span class="params">(T t)</span></span></span><br><span class="line"><span class="function"><span class="comment">//插入数据,需要有主键,有什么属性插入什么属性</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insertSelective</span><span class="params">(T t)</span></span></span><br><span class="line"><span class="function"><span class="comment">//插入数据,需要有主键,需要数据库表中的所有字段全都存在,否则插入失败,此方法不常用</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(T t)</span></span></span><br><span class="line"><span class="function"><span class="comment">//根据条件删除数据,原理同select(T)</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">delete</span><span class="params">(T t)</span></span></span><br><span class="line"><span class="function"><span class="comment">//根据主键删除</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">deleteByPrimaryKey</span><span class="params">(T t)</span></span></span><br></pre></td></tr></table></figure></p><p>测试类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserMapperTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQuery</span><span class="params">()</span></span>&#123;</span><br><span class="line">        User user = userMapper.selectByPrimaryKey(<span class="number">1L</span>);</span><br><span class="line">        System.out.println(<span class="string">"user = "</span>+ user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>使用的是springboot开发，导入测试方法选择springboot中所集成的测试类，在需要测测试方法中使用@SpringBootTest。<br>service层实现方法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">queryById</span><span class="params">(Integer id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUser</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line">        userMapper.insert(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>controller层实现<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">hello</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id)</span>&#123;</span><br><span class="line">       <span class="comment">// System.out.println("hello methd is running");</span></span><br><span class="line">        <span class="keyword">return</span> userService.queryById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>项目运行结果：<br><img src="/images/a.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Springboot整合Mybatis&quot;&gt;&lt;a href=&quot;#Springboot整合Mybatis&quot; class=&quot;headerlink&quot; title=&quot;Springboot整合Mybatis&quot;&gt;&lt;/a&gt;Springboot整合Mybatis&lt;/h2&gt;&lt;p&gt;Sp
      
    
    </summary>
    
      <category term="java" scheme="https://github.com/smallmartial/blog.git/categories/java/"/>
    
    
      <category term="java" scheme="https://github.com/smallmartial/blog.git/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>JAVA知识点总结一</title>
    <link href="https://github.com/smallmartial/blog.git/2019/04/02/JAVA%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93%E4%B8%80/"/>
    <id>https://github.com/smallmartial/blog.git/2019/04/02/JAVA知识点总结一/</id>
    <published>2019-04-02T06:26:04.000Z</published>
    <updated>2019-04-11T06:09:38.490Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-HashMap和HashTable的描述"><a href="#1-HashMap和HashTable的描述" class="headerlink" title="1.HashMap和HashTable的描述"></a>1.HashMap和HashTable的描述</h3><ul><li>他们都实现了Map接口</li><li>HashMap非线程安全，在多个线程访问Hashtable时，不需要自己为他的方法实现同步，而HashMap必须为此提供额外的同步。</li><li>HashMap允许将null作为一个entry的key或者value,而Hashtable不允许。</li><li>HashMap无contains方法<h3 id="2-在java7中，不用用作switch参数的类型是浮点型"><a href="#2-在java7中，不用用作switch参数的类型是浮点型" class="headerlink" title="2.在java7中，不用用作switch参数的类型是浮点型"></a>2.在java7中，不用用作switch参数的类型是浮点型</h3></li><li>switch语句后控制表达式只能是short、char、int、long整数类型和枚举类型，不能是float、double、boolean类型，String类型是java7支持的。<h3 id="ArrayList和LinkedList的区别"><a href="#ArrayList和LinkedList的区别" class="headerlink" title="ArrayList和LinkedList的区别"></a>ArrayList和LinkedList的区别</h3></li><li>ArrayList是实现了基于动态数组的数据结构，LinkedList是基于链表的数据结构</li><li>对于随机访问get和set,ArrayList优于LinkedList,因为LinkedList要移动指针</li><li>对于新增和删除操作add和remove,LinkedList比较占优势,因为ArrayList要移动资源</li><li>ArrayList的空间浪费主要体现在list列表的结构预留一定的容量空间，而LinkedList的空间花费则体现在它的每一个都需要消耗相当的空间。</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;1-HashMap和HashTable的描述&quot;&gt;&lt;a href=&quot;#1-HashMap和HashTable的描述&quot; class=&quot;headerlink&quot; title=&quot;1.HashMap和HashTable的描述&quot;&gt;&lt;/a&gt;1.HashMap和HashTable的
      
    
    </summary>
    
      <category term="java" scheme="https://github.com/smallmartial/blog.git/categories/java/"/>
    
    
      <category term="java" scheme="https://github.com/smallmartial/blog.git/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>SSM知识总结</title>
    <link href="https://github.com/smallmartial/blog.git/2019/03/30/SSM%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/"/>
    <id>https://github.com/smallmartial/blog.git/2019/03/30/SSM知识总结/</id>
    <published>2019-03-30T08:19:43.000Z</published>
    <updated>2019-04-11T06:09:50.006Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SSM重点知识"><a href="#SSM重点知识" class="headerlink" title="SSM重点知识"></a>SSM重点知识</h1><h2 id="SpringMVC-DispatcherServlet"><a href="#SpringMVC-DispatcherServlet" class="headerlink" title="SpringMVC:DispatcherServlet"></a>SpringMVC:DispatcherServlet</h2><ul><li>DispatcherServlet是SpringMVC的心脏，它负责接收 HTTP 请求并协调 Spring MVC 的各个组件完成请求处理的工作。DispatcherServlet 本质也是一个 Servlet，用户必须在 web.xml 中配置。</li></ul><h3 id="DispatcherServlet-可以分为三个功能"><a href="#DispatcherServlet-可以分为三个功能" class="headerlink" title="DispatcherServlet 可以分为三个功能"></a>DispatcherServlet 可以分为三个功能</h3><ul><li>截获Http请求，交给SpringMVC框架处理</li><li>处理 控制层、业务层、持久层之间的调用关系</li><li>初始化并装配SpringMVC的各个组件</li></ul><h3 id="配置DispatcherServlet"><a href="#配置DispatcherServlet" class="headerlink" title="配置DispatcherServlet"></a>配置DispatcherServlet</h3><p>在web.xml中配置一个Servlet,并通过<servlet-mappting>指定处理的URL<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;servlet&gt;</span><br><span class="line">  &lt;servlet-name&gt;spring-dispatcher&lt;/servlet-name&gt;</span><br><span class="line">  &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;</span><br><span class="line">  &lt;!-- 配置springMVC需要加载的配置文件 spring-dao.xml,spring-service.xml,spring-web.xml</span><br><span class="line">      Mybatis - &gt; spring -&gt; springmvc --&gt;</span><br><span class="line">  &lt;init-param&gt;</span><br><span class="line">    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">    &lt;param-value&gt;classpath:spring/spring-*.xml&lt;/param-value&gt;</span><br><span class="line">  &lt;/init-param&gt;</span><br><span class="line">&lt;/servlet&gt;</span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">  &lt;servlet-name&gt;spring-dispatcher&lt;/servlet-name&gt;</span><br><span class="line">  &lt;!-- 默认匹配所有的请求 --&gt;</span><br><span class="line">  &lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">&lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure></servlet-mappting></p><h3 id="截获HTTP请求"><a href="#截获HTTP请求" class="headerlink" title="截获HTTP请求"></a>截获HTTP请求</h3><p> 通过 &lt; servlet-mapping&gt; 指定 DispatcherServlet 处理所有的 HTTP 请求，这里的“/”表示浏览器中的 URL 都会被 DispatcherServlet 接收。大多数情况，我们都会让 DispatcherServlet 处理以某种特定的 URL，比如以 .html 为后缀的 HTTP 请求：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">  &lt;servlet-name&gt;spring-dispatcher&lt;/servlet-name&gt;</span><br><span class="line">  &lt;!-- 默认匹配所有的请求 --&gt;</span><br><span class="line">  &lt;url-pattern&gt;/*.html&lt;/url-pattern&gt;</span><br><span class="line">&lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure><h2 id="Spring-IOC和AOP"><a href="#Spring-IOC和AOP" class="headerlink" title="Spring:IOC和AOP"></a>Spring:IOC和AOP</h2><pre><code>在面向切片编成中,IOC和AOP是spring的灵魂。</code></pre><ul><li><p>IOC:控制反转也叫依赖注入。利用了工厂模式，将对象交给容器管，只需要在spring配置文件总配置相应的bean，以及设置相关的属性，让spring容器来生成类的实例对象以及管理对象。在spring容器启动的时候，spring会把你在配置文件中配置的bean都初始化好，然后在你需要调用的时候，就把它已经初始化好的那些bean分配给你需要调用这些bean的类（假设这个类名是A），分配的方法就是调用A的setter方法来注入，而不需要你在A里面new这些bean了。</p></li><li><p>AOP：面向切面编程（典型的代理模式）AOP可以说是对OOP的补充和完善。OOP引入封装、继承和多态性等概念来建立一种对象层次结构，用以模拟公共行为的一个集合。当我们需要为分散的对象引入公共行为的时候，OOP则显得无能为力。也就是说，OOP允许你定义从上到下的关系，但并不适合定义从左到右的关系。例如日志功能。日志代码往往水平地散布在所有对象层次中，而与它所散布到的对象的核心功能毫无关系。在OOP设计中，它导致了大量代码的重复，而不利于各个模块的重用。</p></li><li><p>实现AOP的技术，主要分为两大类：一是采用动态代理技术，利用截取消息的方式，对该消息进行装饰，以取代原有对象行为的执行；二是采用静态织入的方式，引入特定的语法创建“方面”，从而使得编译器可以在编译期间织入有关“方面”的代码。</p></li><li><p>AOP的特性: 1.各个步骤之间的良好隔离性。2.源代码无关性</p></li></ul><h2 id="MyBatis-ORM"><a href="#MyBatis-ORM" class="headerlink" title="MyBatis:ORM"></a>MyBatis:ORM</h2><h3 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h3><p>Java程序是通过JDBC(Java Data Base Connectivity)连接数据库的，JDBC是由SUN公司提出的一系列规范，但是它只定义了接口的规范，而具体的实现是交给了各个数据库厂商去实现的，JDBC是一种典型的桥接模式.</p><h3 id="JDBC编写步骤"><a href="#JDBC编写步骤" class="headerlink" title="JDBC编写步骤"></a>JDBC编写步骤</h3><ul><li>使用JDBC编程需要连接数据库，注册驱动和数据库信息</li><li>操作Connection,打开Statement对象</li><li>通过Statement执行SQL,返回结果到ResultSet对象</li><li>使用ResultSet读取数据，然后通过代码转换为具体的POJO对象</li><li>关闭数据库相关资源</li></ul><h3 id="JDBC弊端"><a href="#JDBC弊端" class="headerlink" title="JDBC弊端"></a>JDBC弊端</h3><ul><li>工作量大</li><li>编程复杂</li></ul><h3 id="ORM模型"><a href="#ORM模型" class="headerlink" title="ORM模型"></a>ORM模型</h3><ul><li><p>ORM取代了JDBC,所有的ORM模型都是基于JDBC进行封装的，不同ORM模型对JDBC封装的强度是不一样的</p></li><li><p>对象关系映射(Object Relational Mapping),简单的说ORM框架就是数据库的表和简单Java对象的映射关系模型，我们通过这层映射关系就可以简单迅速地把数据库表的数据转化为POJO</p></li></ul><h3 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h3><p>mybatis是一个java持久层框架，它封装少、高性能·可优化、维护简单等优点成为了目前java移动互联网网站服务的首选持久层框架，它特别适合分布式和大数据网络数据库编程<br>之所以称它为半自动，是因为它需要手工匹配提供POJO、SQL和映射关系，而全表映射的Hibernate只需要提供POJO和映射关系便可。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;SSM重点知识&quot;&gt;&lt;a href=&quot;#SSM重点知识&quot; class=&quot;headerlink&quot; title=&quot;SSM重点知识&quot;&gt;&lt;/a&gt;SSM重点知识&lt;/h1&gt;&lt;h2 id=&quot;SpringMVC-DispatcherServlet&quot;&gt;&lt;a href=&quot;#Spring
      
    
    </summary>
    
      <category term="java" scheme="https://github.com/smallmartial/blog.git/categories/java/"/>
    
    
      <category term="java" scheme="https://github.com/smallmartial/blog.git/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>小武的博客</title>
    <link href="https://github.com/smallmartial/blog.git/2019/03/29/hello-world/"/>
    <id>https://github.com/smallmartial/blog.git/2019/03/29/hello-world/</id>
    <published>2019-03-29T12:05:50.000Z</published>
    <updated>2019-04-11T06:19:52.084Z</updated>
    
    <content type="html"><![CDATA[<h2 id="作者简介"><a href="#作者简介" class="headerlink" title="作者简介:"></a>作者简介:</h2><pre><code>小武一名大三学生，目前很丧中...            我本楚狂人，凤歌笑孔丘   the whole of life becomes an act of letting go,    but what always hurts the most is not taking a moment to say goodbye</code></pre><h2 id="Credits"><a href="#Credits" class="headerlink" title="Credits"></a>Credits</h2><pre><code>有一种孤独是原以为找到一个能与自己分享的痛苦的人很难,后来才发现找到一个能分享自己喜悦的人更难。爱自己是终生浪漫的开始,我们一直在坚持着，不是为了改变这个世界，而是希望不被这个世界所改变。</code></pre><h2 id="我们站在巨人的肩膀上"><a href="#我们站在巨人的肩膀上" class="headerlink" title="我们站在巨人的肩膀上"></a>我们站在巨人的肩膀上</h2><pre><code>. 和一些人的关系就像平行线，一辈子相守相望，见于眼底藏于心间。. 就怕耐不住寂寞，冲动而成了相交线，在一个点尽情拥抱，  从此便离得越来越远，再也不见。. 遇见这样的人，因为不想做恋人只能一时，所以才选择做朋友能一世。</code></pre><h2 id="Here-with-you"><a href="#Here-with-you" class="headerlink" title="Here with you"></a>Here with you</h2><pre><code>I love three things in this world.Sun,Moon and You.Sun for moring,Moon for night, and you forever.浮世三千，吾爱有三日、月与卿。日为朝，月为暮卿为朝朝暮暮</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;作者简介&quot;&gt;&lt;a href=&quot;#作者简介&quot; class=&quot;headerlink&quot; title=&quot;作者简介:&quot;&gt;&lt;/a&gt;作者简介:&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;小武一名大三学生，目前很丧中...
            我本楚狂人，凤歌笑孔丘

   the wh
      
    
    </summary>
    
      <category term="作者简介" scheme="https://github.com/smallmartial/blog.git/categories/%E4%BD%9C%E8%80%85%E7%AE%80%E4%BB%8B/"/>
    
    
      <category term="我本楚狂人，凤歌笑孔丘" scheme="https://github.com/smallmartial/blog.git/tags/%E6%88%91%E6%9C%AC%E6%A5%9A%E7%8B%82%E4%BA%BA%EF%BC%8C%E5%87%A4%E6%AD%8C%E7%AC%91%E5%AD%94%E4%B8%98/"/>
    
  </entry>
  
</feed>
